"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6538],{87414:function(t,r,n){let i,s,o,a,l;n.d(r,{U:function(){return Replay}});var d,c,u,h,p,m,f,g,y=n(84247),S=n(44688),_=n(75351),v=n(85606),b=n(83853),E=n(55124),w=n(58405),k=n(91240),I=n(2253),R=n(39252),M=n(37302),T=n(38546),C=n(20082),x=n(51718),N=n(44332),D=n(32585),O=n(84626),A=n(55112);let B=E.n2,L="sentryReplaySession",P="Unable to send Replay";function isElement$1(t){return t.nodeType===t.ELEMENT_NODE}function isShadowRoot(t){let r=null==t?void 0:t.host;return(null==r?void 0:r.shadowRoot)===t}function isNativeShadowDom(t){return"[object ShadowRoot]"===Object.prototype.toString.call(t)}function fixBrowserCompatibilityIssuesInCSS(t){return t.includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),t}function escapeImportStatement(t){let{cssText:r}=t;if(r.split('"').length<3)return r;let n=["@import",`url(${JSON.stringify(t.href)})`];return""===t.layerName?n.push("layer"):t.layerName&&n.push(`layer(${t.layerName})`),t.supportsText&&n.push(`supports(${t.supportsText})`),t.media.length&&n.push(t.media.mediaText),n.join(" ")+";"}function stringifyStylesheet(t){try{let r=t.rules||t.cssRules;return r?fixBrowserCompatibilityIssuesInCSS(Array.from(r,stringifyRule).join("")):null}catch(t){return null}}function stringifyRule(t){let r;if(isCSSImportRule(t))try{r=stringifyStylesheet(t.styleSheet)||escapeImportStatement(t)}catch(t){}else if(isCSSStyleRule(t)&&t.selectorText.includes(":"))return fixSafariColons(t.cssText);return r||t.cssText}function fixSafariColons(t){return t.replace(/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm,"$1\\$2")}function isCSSImportRule(t){return"styleSheet"in t}function isCSSStyleRule(t){return"selectorText"in t}(d=f||(f={}))[d.Document=0]="Document",d[d.DocumentType=1]="DocumentType",d[d.Element=2]="Element",d[d.Text=3]="Text",d[d.CDATA=4]="CDATA",d[d.Comment=5]="Comment";let Mirror=class Mirror{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var r;if(!t)return -1;let n=null===(r=this.getMeta(t))||void 0===r?void 0:r.id;return null!=n?n:-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){let r=this.getId(t);this.idNodeMap.delete(r),t.childNodes&&t.childNodes.forEach(t=>this.removeNodeFromMap(t))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,r){let n=r.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,r)}replace(t,r){let n=this.getNode(t);if(n){let t=this.nodeMetaMap.get(n);t&&this.nodeMetaMap.set(r,t)}this.idNodeMap.set(t,r)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}};function createMirror(){return new Mirror}function shouldMaskInput({maskInputOptions:t,tagName:r,type:n}){return"OPTION"===r&&(r="SELECT"),!!(t[r.toLowerCase()]||n&&t[n]||"password"===n||"INPUT"===r&&!n&&t.text)}function maskInputValue({isMasked:t,element:r,value:n,maskInputFn:i}){let s=n||"";return t?(i&&(s=i(s,r)),"*".repeat(s.length)):s}function toLowerCase(t){return t.toLowerCase()}function toUpperCase(t){return t.toUpperCase()}let F="__rrweb_original__";function is2DCanvasBlank(t){let r=t.getContext("2d");if(!r)return!0;for(let n=0;n<t.width;n+=50)for(let i=0;i<t.height;i+=50){let s=r.getImageData,o=F in s?s[F]:s,a=new Uint32Array(o.call(r,n,i,Math.min(50,t.width-n),Math.min(50,t.height-i)).data.buffer);if(a.some(t=>0!==t))return!1}return!0}function getInputType(t){let r=t.type;return t.hasAttribute("data-rr-is-password")?"password":r?toLowerCase(r):null}function getInputValue(t,r,n){return"INPUT"===r&&("radio"===n||"checkbox"===n)?t.getAttribute("value")||"":t.value}let W=1,U=RegExp("[^a-z0-9-_:]");function genId(){return W++}function getValidTagName(t){if(t instanceof HTMLFormElement)return"form";let r=toLowerCase(t.tagName);return U.test(r)?"div":r}function extractOrigin(t){return(t.indexOf("//")>-1?t.split("/").slice(0,3).join("/"):t.split("/")[0]).split("?")[0]}let z=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,H=/^(?:[a-z+]+:)?\/\//i,j=/^www\..*/i,G=/^(data:)([^,]*),(.*)/i;function absoluteToStylesheet(t,r){return(t||"").replace(z,(t,n,i,s,o,a)=>{let l=i||o||a,d=n||s||"";if(!l)return t;if(H.test(l)||j.test(l)||G.test(l))return`url(${d}${l}${d})`;if("/"===l[0])return`url(${d}${extractOrigin(r)+l}${d})`;let c=r.split("/"),u=l.split("/");for(let t of(c.pop(),u))"."!==t&&(".."===t?c.pop():c.push(t));return`url(${d}${c.join("/")}${d})`})}let $=/^[^ \t\n\r\u000c]+/,q=/^[, \t\n\r\u000c]+/;function getAbsoluteSrcsetString(t,r){if(""===r.trim())return r;let n=0;function collectCharacters(t){let i;let s=t.exec(r.substring(n));return s?(i=s[0],n+=i.length,i):""}let i=[];for(;collectCharacters(q),!(n>=r.length);){let s=collectCharacters($);if(","===s.slice(-1))s=absoluteToDoc(t,s.substring(0,s.length-1)),i.push(s);else{let o="";s=absoluteToDoc(t,s);let a=!1;for(;;){let t=r.charAt(n);if(""===t){i.push((s+o).trim());break}if(a)")"===t&&(a=!1);else{if(","===t){n+=1,i.push((s+o).trim());break}"("===t&&(a=!0)}o+=t,n+=1}}}return i.join(", ")}function absoluteToDoc(t,r){if(!r||""===r.trim())return r;let n=t.createElement("a");return n.href=r,n.href}function isSVGElement(t){return!!("svg"===t.tagName||t.ownerSVGElement)}function getHref(){let t=document.createElement("a");return t.href="",t.href}function transformAttribute(t,r,n,i,s,o){return i?"src"!==n&&("href"!==n||"use"===r&&"#"===i[0])&&("xlink:href"!==n||"#"===i[0])&&("background"!==n||"table"!==r&&"td"!==r&&"th"!==r)?"srcset"===n?getAbsoluteSrcsetString(t,i):"style"===n?absoluteToStylesheet(i,getHref()):"object"===r&&"data"===n?absoluteToDoc(t,i):"function"==typeof o?o(n,i,s):i:absoluteToDoc(t,i):i}function ignoreAttribute(t,r,n){return("video"===t||"audio"===t)&&"autoplay"===r}function _isBlockedElement(t,r,n,i){try{if(i&&t.matches(i))return!1;if("string"==typeof r){if(t.classList.contains(r))return!0}else for(let n=t.classList.length;n--;){let i=t.classList[n];if(r.test(i))return!0}if(n)return t.matches(n)}catch(t){}return!1}function elementClassMatchesRegex(t,r){for(let n=t.classList.length;n--;){let i=t.classList[n];if(r.test(i))return!0}return!1}function distanceToMatch(t,r,n=1/0,i=0){return!t||t.nodeType!==t.ELEMENT_NODE||i>n?-1:r(t)?i:distanceToMatch(t.parentNode,r,n,i+1)}function createMatchPredicate(t,r){return n=>{if(null===n)return!1;if(t){if("string"==typeof t){if(n.matches(`.${t}`))return!0}else if(elementClassMatchesRegex(n,t))return!0}return!!(r&&n.matches(r))}}function needMaskingText(t,r,n,i,s,o){try{let a=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(null===a)return!1;let l=-1,d=-1;if(o){if((d=distanceToMatch(a,createMatchPredicate(i,s)))<0)return!0;l=distanceToMatch(a,createMatchPredicate(r,n),d>=0?d:1/0)}else{if((l=distanceToMatch(a,createMatchPredicate(r,n)))<0)return!1;d=distanceToMatch(a,createMatchPredicate(i,s),l>=0?l:1/0)}return l>=0?!(d>=0)||l<=d:!(d>=0)&&!!o}catch(t){}return!!o}function onceIframeLoaded(t,r,n){let i;let s=t.contentWindow;if(!s)return;let o=!1;try{i=s.document.readyState}catch(t){return}if("complete"!==i){let i=setTimeout(()=>{o||(r(),o=!0)},n);t.addEventListener("load",()=>{clearTimeout(i),o=!0,r()});return}let a="about:blank";if(s.location.href!==a||t.src===a||""===t.src)return setTimeout(r,0),t.addEventListener("load",r);t.addEventListener("load",r)}function onceStylesheetLoaded(t,r,n){let i,s=!1;try{i=t.sheet}catch(t){return}if(i)return;let o=setTimeout(()=>{s||(r(),s=!0)},n);t.addEventListener("load",()=>{clearTimeout(o),s=!0,r()})}function serializeNode(t,r){let{doc:n,mirror:i,blockClass:s,blockSelector:o,unblockSelector:a,maskAllText:l,maskAttributeFn:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,inlineStylesheet:m,maskInputOptions:g={},maskTextFn:y,maskInputFn:S,dataURLOptions:_={},inlineImages:v,recordCanvas:b,keepIframeSrcFn:E,newlyAddedElement:w=!1}=r,k=getRootId(n,i);switch(t.nodeType){case t.DOCUMENT_NODE:if("CSS1Compat"!==t.compatMode)return{type:f.Document,childNodes:[],compatMode:t.compatMode};return{type:f.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:f.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:k};case t.ELEMENT_NODE:return serializeElementNode(t,{doc:n,blockClass:s,blockSelector:o,unblockSelector:a,inlineStylesheet:m,maskAttributeFn:d,maskInputOptions:g,maskInputFn:S,dataURLOptions:_,inlineImages:v,recordCanvas:b,keepIframeSrcFn:E,newlyAddedElement:w,rootId:k,maskAllText:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p});case t.TEXT_NODE:return serializeTextNode(t,{maskAllText:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,maskTextFn:y,maskInputOptions:g,maskInputFn:S,rootId:k});case t.CDATA_SECTION_NODE:return{type:f.CDATA,textContent:"",rootId:k};case t.COMMENT_NODE:return{type:f.Comment,textContent:t.textContent||"",rootId:k};default:return!1}}function getRootId(t,r){if(!r.hasNode(t))return;let n=r.getId(t);return 1===n?void 0:n}function serializeTextNode(t,r){var n;let{maskAllText:i,maskTextClass:s,unmaskTextClass:o,maskTextSelector:a,unmaskTextSelector:l,maskTextFn:d,maskInputOptions:c,maskInputFn:u,rootId:h}=r,p=t.parentNode&&t.parentNode.tagName,m=t.textContent,g="STYLE"===p||void 0,y="SCRIPT"===p||void 0,S="TEXTAREA"===p||void 0;if(g&&m){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(m=stringifyStylesheet(t.parentNode.sheet))}catch(r){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${r}`,t)}m=absoluteToStylesheet(m,getHref())}y&&(m="SCRIPT_PLACEHOLDER");let _=needMaskingText(t,s,a,o,l,i);if(g||y||S||!m||!_||(m=d?d(m):m.replace(/[\S]/g,"*")),S&&m&&(c.textarea||_)&&(m=u?u(m,t.parentNode):m.replace(/[\S]/g,"*")),"OPTION"===p&&m){let r=shouldMaskInput({type:null,tagName:p,maskInputOptions:c});m=maskInputValue({isMasked:needMaskingText(t,s,a,o,l,r),element:t,value:m,maskInputFn:u})}return{type:f.Text,textContent:m||"",isStyle:g,rootId:h}}function serializeElementNode(t,r){let n;let{doc:o,blockClass:a,blockSelector:l,unblockSelector:d,inlineStylesheet:c,maskInputOptions:u={},maskAttributeFn:h,maskInputFn:p,dataURLOptions:m={},inlineImages:g,recordCanvas:y,keepIframeSrcFn:S,newlyAddedElement:_=!1,rootId:v,maskAllText:b,maskTextClass:E,unmaskTextClass:w,maskTextSelector:k,unmaskTextSelector:I}=r,R=_isBlockedElement(t,a,l,d),M=getValidTagName(t),T={},C=t.attributes.length;for(let r=0;r<C;r++){let n=t.attributes[r];ignoreAttribute(M,n.name,n.value)||(T[n.name]=transformAttribute(o,M,toLowerCase(n.name),n.value,t,h))}if("link"===M&&c){let r=Array.from(o.styleSheets).find(r=>r.href===t.href),n=null;r&&(n=stringifyStylesheet(r)),n&&(delete T.rel,delete T.href,T._cssText=absoluteToStylesheet(n,r.href))}if("style"===M&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){let r=stringifyStylesheet(t.sheet);r&&(T._cssText=absoluteToStylesheet(r,getHref()))}if("input"===M||"textarea"===M||"select"===M||"option"===M){let r=getInputType(t),n=getInputValue(t,toUpperCase(M),r),i=t.checked;if("submit"!==r&&"button"!==r&&n){let i=needMaskingText(t,E,k,w,I,shouldMaskInput({type:r,tagName:toUpperCase(M),maskInputOptions:u}));T.value=maskInputValue({isMasked:i,element:t,value:n,maskInputFn:p})}i&&(T.checked=i)}if("option"===M&&(t.selected&&!u.select?T.selected=!0:delete T.selected),"canvas"===M&&y){if("2d"===t.__context)is2DCanvasBlank(t)||(T.rr_dataURL=t.toDataURL(m.type,m.quality));else if(!("__context"in t)){let r=t.toDataURL(m.type,m.quality),n=document.createElement("canvas");n.width=t.width,n.height=t.height;let i=n.toDataURL(m.type,m.quality);r!==i&&(T.rr_dataURL=r)}}if("img"===M&&g){i||(s=(i=o.createElement("canvas")).getContext("2d"));let r=t.crossOrigin;t.crossOrigin="anonymous";let recordInlineImage=()=>{t.removeEventListener("load",recordInlineImage);try{i.width=t.naturalWidth,i.height=t.naturalHeight,s.drawImage(t,0,0),T.rr_dataURL=i.toDataURL(m.type,m.quality)}catch(r){console.warn(`Cannot inline img src=${t.currentSrc}! Error: ${r}`)}r?T.crossOrigin=r:t.removeAttribute("crossorigin")};t.complete&&0!==t.naturalWidth?recordInlineImage():t.addEventListener("load",recordInlineImage)}if(("audio"===M||"video"===M)&&(T.rr_mediaState=t.paused?"paused":"played",T.rr_mediaCurrentTime=t.currentTime),!_&&(t.scrollLeft&&(T.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(T.rr_scrollTop=t.scrollTop)),R){let{width:r,height:n}=t.getBoundingClientRect();T={class:T.class,rr_width:`${r}px`,rr_height:`${n}px`}}"iframe"!==M||S(T.src)||(t.contentDocument||(T.rr_src=T.src),delete T.src);try{customElements.get(M)&&(n=!0)}catch(t){}return{type:f.Element,tagName:M,attributes:T,childNodes:[],isSVG:isSVGElement(t)||void 0,needBlock:R,rootId:v,isCustom:n}}function lowerIfExists(t){return null==t?"":t.toLowerCase()}function slimDOMExcluded(t,r){if(r.comment&&t.type===f.Comment)return!0;if(t.type===f.Element){if(r.script&&("script"===t.tagName||"link"===t.tagName&&("preload"===t.attributes.rel||"modulepreload"===t.attributes.rel)&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js"))||r.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(lowerIfExists(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===lowerIfExists(t.attributes.name)||"icon"===lowerIfExists(t.attributes.rel)||"apple-touch-icon"===lowerIfExists(t.attributes.rel)||"shortcut icon"===lowerIfExists(t.attributes.rel))))return!0;if("meta"===t.tagName){if(r.headMetaDescKeywords&&lowerIfExists(t.attributes.name).match(/^description|keywords$/)||r.headMetaSocial&&(lowerIfExists(t.attributes.property).match(/^(og|twitter|fb):/)||lowerIfExists(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===lowerIfExists(t.attributes.name)))return!0;if(r.headMetaRobots&&("robots"===lowerIfExists(t.attributes.name)||"googlebot"===lowerIfExists(t.attributes.name)||"bingbot"===lowerIfExists(t.attributes.name)))return!0;if(r.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;else if(r.headMetaAuthorship&&("author"===lowerIfExists(t.attributes.name)||"generator"===lowerIfExists(t.attributes.name)||"framework"===lowerIfExists(t.attributes.name)||"publisher"===lowerIfExists(t.attributes.name)||"progid"===lowerIfExists(t.attributes.name)||lowerIfExists(t.attributes.property).match(/^article:/)||lowerIfExists(t.attributes.property).match(/^product:/)))return!0;else if(r.headMetaVerification&&("google-site-verification"===lowerIfExists(t.attributes.name)||"yandex-verification"===lowerIfExists(t.attributes.name)||"csrf-token"===lowerIfExists(t.attributes.name)||"p:domain_verify"===lowerIfExists(t.attributes.name)||"verify-v1"===lowerIfExists(t.attributes.name)||"verification"===lowerIfExists(t.attributes.name)||"shopify-checkout-api-token"===lowerIfExists(t.attributes.name)))return!0}}return!1}function serializeNodeWithId(t,r){let n;let{doc:i,mirror:s,blockClass:o,blockSelector:a,unblockSelector:l,maskAllText:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:m=!1,inlineStylesheet:g=!0,maskInputOptions:y={},maskAttributeFn:S,maskTextFn:_,maskInputFn:v,slimDOMOptions:b,dataURLOptions:E={},inlineImages:w=!1,recordCanvas:k=!1,onSerialize:I,onIframeLoad:R,iframeLoadTimeout:M=5e3,onStylesheetLoad:T,stylesheetLoadTimeout:C=5e3,keepIframeSrcFn:x=()=>!1,newlyAddedElement:N=!1}=r,{preserveWhiteSpace:D=!0}=r,O=serializeNode(t,{doc:i,mirror:s,blockClass:o,blockSelector:a,maskAllText:d,unblockSelector:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,inlineStylesheet:g,maskInputOptions:y,maskAttributeFn:S,maskTextFn:_,maskInputFn:v,dataURLOptions:E,inlineImages:w,recordCanvas:k,keepIframeSrcFn:x,newlyAddedElement:N});if(!O)return console.warn(t,"not serialized"),null;n=s.hasNode(t)?s.getId(t):!slimDOMExcluded(O,b)&&(D||O.type!==f.Text||O.isStyle||O.textContent.replace(/^\s+|\s+$/gm,"").length)?genId():-2;let A=Object.assign(O,{id:n});if(s.add(t,A),-2===n)return null;I&&I(t);let B=!m;if(A.type===f.Element){B=B&&!A.needBlock,delete A.needBlock;let r=t.shadowRoot;r&&isNativeShadowDom(r)&&(A.isShadowHost=!0)}if((A.type===f.Document||A.type===f.Element)&&B){b.headWhitespace&&A.type===f.Element&&"head"===A.tagName&&(D=!1);let r={doc:i,mirror:s,blockClass:o,blockSelector:a,maskAllText:d,unblockSelector:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:m,inlineStylesheet:g,maskInputOptions:y,maskAttributeFn:S,maskTextFn:_,maskInputFn:v,slimDOMOptions:b,dataURLOptions:E,inlineImages:w,recordCanvas:k,preserveWhiteSpace:D,onSerialize:I,onIframeLoad:R,iframeLoadTimeout:M,onStylesheetLoad:T,stylesheetLoadTimeout:C,keepIframeSrcFn:x};for(let n of Array.from(t.childNodes)){let t=serializeNodeWithId(n,r);t&&A.childNodes.push(t)}if(isElement$1(t)&&t.shadowRoot)for(let n of Array.from(t.shadowRoot.childNodes)){let i=serializeNodeWithId(n,r);i&&(isNativeShadowDom(t.shadowRoot)&&(i.isShadow=!0),A.childNodes.push(i))}}return t.parentNode&&isShadowRoot(t.parentNode)&&isNativeShadowDom(t.parentNode)&&(A.isShadow=!0),A.type===f.Element&&"iframe"===A.tagName&&onceIframeLoaded(t,()=>{let r=t.contentDocument;if(r&&R){let n=serializeNodeWithId(r,{doc:r,mirror:s,blockClass:o,blockSelector:a,unblockSelector:l,maskAllText:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:!1,inlineStylesheet:g,maskInputOptions:y,maskAttributeFn:S,maskTextFn:_,maskInputFn:v,slimDOMOptions:b,dataURLOptions:E,inlineImages:w,recordCanvas:k,preserveWhiteSpace:D,onSerialize:I,onIframeLoad:R,iframeLoadTimeout:M,onStylesheetLoad:T,stylesheetLoadTimeout:C,keepIframeSrcFn:x});n&&R(t,n)}},M),A.type===f.Element&&"link"===A.tagName&&"stylesheet"===A.attributes.rel&&onceStylesheetLoaded(t,()=>{if(T){let r=serializeNodeWithId(t,{doc:i,mirror:s,blockClass:o,blockSelector:a,unblockSelector:l,maskAllText:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:!1,inlineStylesheet:g,maskInputOptions:y,maskAttributeFn:S,maskTextFn:_,maskInputFn:v,slimDOMOptions:b,dataURLOptions:E,inlineImages:w,recordCanvas:k,preserveWhiteSpace:D,onSerialize:I,onIframeLoad:R,iframeLoadTimeout:M,onStylesheetLoad:T,stylesheetLoadTimeout:C,keepIframeSrcFn:x});r&&T(t,r)}},C),A}function snapshot(t,r){let{mirror:n=new Mirror,blockClass:i="rr-block",blockSelector:s=null,unblockSelector:o=null,maskAllText:a=!1,maskTextClass:l="rr-mask",unmaskTextClass:d=null,maskTextSelector:c=null,unmaskTextSelector:u=null,inlineStylesheet:h=!0,inlineImages:p=!1,recordCanvas:m=!1,maskAllInputs:f=!1,maskAttributeFn:g,maskTextFn:y,maskInputFn:S,slimDOM:_=!1,dataURLOptions:v,preserveWhiteSpace:b,onSerialize:E,onIframeLoad:w,iframeLoadTimeout:k,onStylesheetLoad:I,stylesheetLoadTimeout:R,keepIframeSrcFn:M=()=>!1}=r||{},T=!0===f?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===f?{}:f,C=!0===_||"all"===_?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===_,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===_?{}:_;return serializeNodeWithId(t,{doc:t,mirror:n,blockClass:i,blockSelector:s,unblockSelector:o,maskAllText:a,maskTextClass:l,unmaskTextClass:d,maskTextSelector:c,unmaskTextSelector:u,skipChild:!1,inlineStylesheet:h,maskInputOptions:T,maskAttributeFn:g,maskTextFn:y,maskInputFn:S,slimDOMOptions:C,dataURLOptions:v,inlineImages:p,recordCanvas:m,preserveWhiteSpace:b,onSerialize:E,onIframeLoad:w,iframeLoadTimeout:k,onStylesheetLoad:I,stylesheetLoadTimeout:R,keepIframeSrcFn:M,newlyAddedElement:!1})}function on(t,r,n=document){let i={capture:!0,passive:!0};return n.addEventListener(t,r,i),()=>n.removeEventListener(t,r,i)}let Y="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",V={map:{},getId:()=>(console.error(Y),-1),getNode:()=>(console.error(Y),null),removeNodeFromMap(){console.error(Y)},has:()=>(console.error(Y),!1),reset(){console.error(Y)}};function throttle$1(t,r,n={}){let i=null,s=0;return function(...o){let a=Date.now();s||!1!==n.leading||(s=a);let l=r-(a-s),d=this;l<=0||l>r?(i&&(clearTimeout(i),i=null),s=a,t.apply(d,o)):i||!1===n.trailing||(i=setTimeout(()=>{s=!1===n.leading?0:Date.now(),i=null,t.apply(d,o)},l))}}function hookSetter(t,r,n,i,s=window){let o=s.Object.getOwnPropertyDescriptor(t,r);return s.Object.defineProperty(t,r,i?n:{set(t){setTimeout(()=>{n.set.call(this,t)},0),o&&o.set&&o.set.call(this,t)}}),()=>hookSetter(t,r,o||{},!0)}function patch(t,r,n){try{if(!(r in t))return()=>{};let i=t[r],s=n(i);return"function"==typeof s&&(s.prototype=s.prototype||{},Object.defineProperties(s,{__rrweb_original__:{enumerable:!1,value:i}})),t[r]=s,()=>{t[r]=i}}catch(t){return()=>{}}}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(V=new Proxy(V,{get:(t,r,n)=>("map"===r&&console.error(Y),Reflect.get(t,r,n))}));let K=Date.now;function getWindowScroll(t){var r,n,i,s,o,a;let l=t.document;return{left:l.scrollingElement?l.scrollingElement.scrollLeft:void 0!==t.pageXOffset?t.pageXOffset:(null==l?void 0:l.documentElement.scrollLeft)||(null===(n=null===(r=null==l?void 0:l.body)||void 0===r?void 0:r.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===(i=null==l?void 0:l.body)||void 0===i?void 0:i.scrollLeft)||0,top:l.scrollingElement?l.scrollingElement.scrollTop:void 0!==t.pageYOffset?t.pageYOffset:(null==l?void 0:l.documentElement.scrollTop)||(null===(o=null===(s=null==l?void 0:l.body)||void 0===s?void 0:s.parentElement)||void 0===o?void 0:o.scrollTop)||(null===(a=null==l?void 0:l.body)||void 0===a?void 0:a.scrollTop)||0}}function getWindowHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function getWindowWidth(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function isBlocked(t,r,n,i,s){if(!t)return!1;let o=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(!o)return!1;let a=createMatchPredicate(r,n);if(!s){let t=i&&o.matches(i);return a(o)&&!t}let l=distanceToMatch(o,a),d=-1;return!(l<0)&&(i&&(d=distanceToMatch(o,createMatchPredicate(null,i))),l>-1&&d<0||l<d)}function isSerialized(t,r){return -1!==r.getId(t)}function isIgnored(t,r){return -2===r.getId(t)}function isAncestorRemoved(t,r){if(isShadowRoot(t))return!1;let n=r.getId(t);return!r.has(n)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||isAncestorRemoved(t.parentNode,r))}function legacy_isTouchEvent(t){return!!t.changedTouches}function polyfill(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let r=t[0];if(!(0 in t))throw TypeError("1 argument is required");do if(this===r)return!0;while(r=r&&r.parentNode);return!1})}function isSerializedIframe(t,r){return!!("IFRAME"===t.nodeName&&r.getMeta(t))}function isSerializedStylesheet(t,r){return!!("LINK"===t.nodeName&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&"stylesheet"===t.getAttribute("rel")&&r.getMeta(t))}function hasShadowRoot(t){return!!(null==t?void 0:t.shadowRoot)}/[1-9][0-9]{12}/.test(Date.now().toString())||(K=()=>new Date().getTime());let StyleSheetMirror=class StyleSheetMirror{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var r;return null!==(r=this.styleIDMap.get(t))&&void 0!==r?r:-1}has(t){return this.styleIDMap.has(t)}add(t,r){let n;return this.has(t)?this.getId(t):(n=void 0===r?this.id++:r,this.styleIDMap.set(t,n),this.idStyleMap.set(n,t),n)}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}};function getShadowHost(t){var r,n;let i=null;return(null===(n=null===(r=t.getRootNode)||void 0===r?void 0:r.call(t))||void 0===n?void 0:n.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&t.getRootNode().host&&(i=t.getRootNode().host),i}function getRootShadowHost(t){let r,n=t;for(;r=getShadowHost(n);)n=r;return n}function shadowHostInDom(t){let r=t.ownerDocument;if(!r)return!1;let n=getRootShadowHost(t);return r.contains(n)}function inDom(t){let r=t.ownerDocument;return!!r&&(r.contains(t)||shadowHostInDom(t))}var X=((c=X||{})[c.DomContentLoaded=0]="DomContentLoaded",c[c.Load=1]="Load",c[c.FullSnapshot=2]="FullSnapshot",c[c.IncrementalSnapshot=3]="IncrementalSnapshot",c[c.Meta=4]="Meta",c[c.Custom=5]="Custom",c[c.Plugin=6]="Plugin",c),J=((u=J||{})[u.Mutation=0]="Mutation",u[u.MouseMove=1]="MouseMove",u[u.MouseInteraction=2]="MouseInteraction",u[u.Scroll=3]="Scroll",u[u.ViewportResize=4]="ViewportResize",u[u.Input=5]="Input",u[u.TouchMove=6]="TouchMove",u[u.MediaInteraction=7]="MediaInteraction",u[u.StyleSheetRule=8]="StyleSheetRule",u[u.CanvasMutation=9]="CanvasMutation",u[u.Font=10]="Font",u[u.Log=11]="Log",u[u.Drag=12]="Drag",u[u.StyleDeclaration=13]="StyleDeclaration",u[u.Selection=14]="Selection",u[u.AdoptedStyleSheet=15]="AdoptedStyleSheet",u[u.CustomElement=16]="CustomElement",u),Q=((h=Q||{})[h.MouseUp=0]="MouseUp",h[h.MouseDown=1]="MouseDown",h[h.Click=2]="Click",h[h.ContextMenu=3]="ContextMenu",h[h.DblClick=4]="DblClick",h[h.Focus=5]="Focus",h[h.Blur=6]="Blur",h[h.TouchStart=7]="TouchStart",h[h.TouchMove_Departed=8]="TouchMove_Departed",h[h.TouchEnd=9]="TouchEnd",h[h.TouchCancel=10]="TouchCancel",h),Z=((p=Z||{})[p.Mouse=0]="Mouse",p[p.Pen=1]="Pen",p[p.Touch=2]="Touch",p);let DoubleLinkedList=class DoubleLinkedList{constructor(){this.length=0,this.head=null,this.tail=null}get(t){if(t>=this.length)throw Error("Position outside of list range");let r=this.head;for(let n=0;n<t;n++)r=(null==r?void 0:r.next)||null;return r}addNode(t){let r={value:t,previous:null,next:null};if(t.__ln=r,t.previousSibling&&"__ln"in t.previousSibling){let n=t.previousSibling.__ln.next;r.next=n,r.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=r,n&&(n.previous=r)}else if(t.nextSibling&&"__ln"in t.nextSibling&&t.nextSibling.__ln.previous){let n=t.nextSibling.__ln.previous;r.previous=n,r.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=r,n&&(n.next=r)}else this.head&&(this.head.previous=r),r.next=this.head,this.head=r;null===r.next&&(this.tail=r),this.length++}removeNode(t){let r=t.__ln;this.head&&(r.previous?(r.previous.next=r.next,r.next?r.next.previous=r.previous:this.tail=r.previous):(this.head=r.next,this.head?this.head.previous=null:this.tail=null),t.__ln&&delete t.__ln,this.length--)}};let moveKey=(t,r)=>`${t}@${r}`;let MutationBuffer=class MutationBuffer{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;let t=[],r=new Set,n=new DoubleLinkedList,getNextId=t=>{let r=t,n=-2;for(;-2===n;)n=(r=r&&r.nextSibling)&&this.mirror.getId(r);return n},pushAdd=i=>{if(!i.parentNode||!inDom(i))return;let s=isShadowRoot(i.parentNode)?this.mirror.getId(getShadowHost(i)):this.mirror.getId(i.parentNode),o=getNextId(i);if(-1===s||-1===o)return n.addNode(i);let a=serializeNodeWithId(i,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:t=>{isSerializedIframe(t,this.mirror)&&this.iframeManager.addIframe(t),isSerializedStylesheet(t,this.mirror)&&this.stylesheetManager.trackLinkElement(t),hasShadowRoot(i)&&this.shadowDomManager.addShadowRoot(i.shadowRoot,this.doc)},onIframeLoad:(t,r)=>{this.iframeManager.attachIframe(t,r),this.shadowDomManager.observeAttachShadow(t)},onStylesheetLoad:(t,r)=>{this.stylesheetManager.attachLinkElement(t,r)}});a&&(t.push({parentId:s,nextId:o,node:a}),r.add(a.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(let t of this.movedSet)(!isParentRemoved(this.removes,t,this.mirror)||this.movedSet.has(t.parentNode))&&pushAdd(t);for(let t of this.addedSet)isAncestorInSet(this.droppedSet,t)||isParentRemoved(this.removes,t,this.mirror)?isAncestorInSet(this.movedSet,t)?pushAdd(t):this.droppedSet.add(t):pushAdd(t);let i=null;for(;n.length;){let t=null;if(i){let r=this.mirror.getId(i.value.parentNode),n=getNextId(i.value);-1!==r&&-1!==n&&(t=i)}if(!t){let r=n.tail;for(;r;){let n=r;if(r=r.previous,n){let r=this.mirror.getId(n.value.parentNode),i=getNextId(n.value);if(-1===i)continue;if(-1!==r){t=n;break}{let r=n.value;if(r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){let i=r.parentNode.host,s=this.mirror.getId(i);if(-1!==s){t=n;break}}}}}}if(!t){for(;n.head;)n.removeNode(n.head.value);break}i=t.previous,n.removeNode(t.value),pushAdd(t.value)}let s={texts:this.texts.map(t=>({id:this.mirror.getId(t.node),value:t.value})).filter(t=>!r.has(t.id)).filter(t=>this.mirror.has(t.id)),attributes:this.attributes.map(t=>{let{attributes:r}=t;if("string"==typeof r.style){let n=JSON.stringify(t.styleDiff),i=JSON.stringify(t._unchangedStyles);n.length<r.style.length&&(n+i).split("var(").length===r.style.split("var(").length&&(r.style=t.styleDiff)}return{id:this.mirror.getId(t.node),attributes:r}}).filter(t=>!r.has(t.id)).filter(t=>this.mirror.has(t.id)),removes:this.removes,adds:t};(s.texts.length||s.attributes.length||s.removes.length||s.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(s))},this.processMutation=t=>{let r;if(!isIgnored(t.target,this.mirror)){try{r=document.implementation.createHTMLDocument()}catch(t){r=this.doc}switch(t.type){case"characterData":{let r=t.target.textContent;isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||r===t.oldValue||this.texts.push({value:needMaskingText(t.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&r?this.maskTextFn?this.maskTextFn(r):r.replace(/[\S]/g,"*"):r,node:t.target});break}case"attributes":{let n=t.target,i=t.attributeName,s=t.target.getAttribute(i);if("value"===i){let r=getInputType(n),i=n.tagName;s=getInputValue(n,i,r);let o=shouldMaskInput({maskInputOptions:this.maskInputOptions,tagName:i,type:r}),a=needMaskingText(t.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,o);s=maskInputValue({isMasked:a,element:n,value:s,maskInputFn:this.maskInputFn})}if(isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||s===t.oldValue)return;let o=this.attributes.find(r=>r.node===t.target);if("IFRAME"===n.tagName&&"src"===i&&!this.keepIframeSrcFn(s)){if(n.contentDocument)return;i="rr_src"}if(o||(o={node:t.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(o)),"type"===i&&"INPUT"===n.tagName&&"password"===(t.oldValue||"").toLowerCase()&&n.setAttribute("data-rr-is-password","true"),!ignoreAttribute(n.tagName,i)&&(o.attributes[i]=transformAttribute(this.doc,toLowerCase(n.tagName),toLowerCase(i),s,n,this.maskAttributeFn),"style"===i)){let i=r.createElement("span");for(let r of(t.oldValue&&i.setAttribute("style",t.oldValue),Array.from(n.style))){let t=n.style.getPropertyValue(r),s=n.style.getPropertyPriority(r);t!==i.style.getPropertyValue(r)||s!==i.style.getPropertyPriority(r)?""===s?o.styleDiff[r]=t:o.styleDiff[r]=[t,s]:o._unchangedStyles[r]=[t,s]}for(let t of Array.from(i.style))""===n.style.getPropertyValue(t)&&(o.styleDiff[t]=!1)}break}case"childList":if(isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;t.addedNodes.forEach(r=>this.genAdds(r,t.target)),t.removedNodes.forEach(r=>{let n=this.mirror.getId(r),i=isShadowRoot(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);!(isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||isIgnored(r,this.mirror))&&isSerialized(r,this.mirror)&&(this.addedSet.has(r)?(deepDelete(this.addedSet,r),this.droppedSet.add(r)):this.addedSet.has(t.target)&&-1===n||isAncestorRemoved(t.target,this.mirror)||(this.movedSet.has(r)&&this.movedMap[moveKey(n,i)]?deepDelete(this.movedSet,r):this.removes.push({parentId:i,id:n,isShadow:!!(isShadowRoot(t.target)&&isNativeShadowDom(t.target))||void 0})),this.mapRemoves.push(r))})}}},this.genAdds=(t,r)=>{if(!this.processedNodeManager.inOtherBuffer(t,this)&&!(this.addedSet.has(t)||this.movedSet.has(t))){if(this.mirror.hasNode(t)){if(isIgnored(t,this.mirror))return;this.movedSet.add(t);let n=null;r&&this.mirror.hasNode(r)&&(n=this.mirror.getId(r)),n&&-1!==n&&(this.movedMap[moveKey(this.mirror.getId(t),n)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);!isBlocked(t,this.blockClass,this.blockSelector,this.unblockSelector,!1)&&(t.childNodes.forEach(t=>this.genAdds(t)),hasShadowRoot(t)&&t.shadowRoot.childNodes.forEach(r=>{this.processedNodeManager.add(r,this),this.genAdds(r,t)}))}}}init(t){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(r=>{this[r]=t[r]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}};function deepDelete(t,r){t.delete(r),r.childNodes.forEach(r=>deepDelete(t,r))}function isParentRemoved(t,r,n){return 0!==t.length&&_isParentRemoved(t,r,n)}function _isParentRemoved(t,r,n){let{parentNode:i}=r;if(!i)return!1;let s=n.getId(i);return!!t.some(t=>t.id===s)||_isParentRemoved(t,i,n)}function isAncestorInSet(t,r){return 0!==t.size&&_isAncestorInSet(t,r)}function _isAncestorInSet(t,r){let{parentNode:n}=r;return!!n&&(!!t.has(n)||_isAncestorInSet(t,n))}function registerErrorHandler(t){o=t}function unregisterErrorHandler(){o=void 0}let callbackWrapper=t=>o?(...r)=>{try{return t(...r)}catch(t){if(o&&!0===o(t))return()=>{};throw t}}:t,ee=[];function getEventTarget(t){try{if("composedPath"in t){let r=t.composedPath();if(r.length)return r[0]}else if("path"in t&&t.path.length)return t.path[0]}catch(t){}return t&&t.target}function initMutationObserver(t,r){var n,i;let s=new MutationBuffer;ee.push(s),s.init(t);let o=window.MutationObserver||window.__rrMutationObserver,a=null===(i=null===(n=null==window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===i?void 0:i.call(n,"MutationObserver");a&&window[a]&&(o=window[a]);let l=new o(callbackWrapper(r=>{t.onMutation&&!1===t.onMutation(r)||s.processMutations.bind(s)(r)}));return l.observe(r,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),l}function initMoveObserver({mousemoveCb:t,sampling:r,doc:n,mirror:i}){let s;if(!1===r.mousemove)return()=>{};let o="number"==typeof r.mousemove?r.mousemove:50,a="number"==typeof r.mousemoveCallback?r.mousemoveCallback:500,l=[],d=throttle$1(callbackWrapper(r=>{let n=Date.now()-s;t(l.map(t=>(t.timeOffset-=n,t)),r),l=[],s=null}),a),c=callbackWrapper(throttle$1(callbackWrapper(t=>{let r=getEventTarget(t),{clientX:n,clientY:o}=legacy_isTouchEvent(t)?t.changedTouches[0]:t;s||(s=K()),l.push({x:n,y:o,id:i.getId(r),timeOffset:K()-s}),d("undefined"!=typeof DragEvent&&t instanceof DragEvent?J.Drag:t instanceof MouseEvent?J.MouseMove:J.TouchMove)}),o,{trailing:!1})),u=[on("mousemove",c,n),on("touchmove",c,n),on("drag",c,n)];return callbackWrapper(()=>{u.forEach(t=>t())})}function initMouseInteractionObserver({mouseInteractionCb:t,doc:r,mirror:n,blockClass:i,blockSelector:s,unblockSelector:o,sampling:a}){if(!1===a.mouseInteraction)return()=>{};let l=!0===a.mouseInteraction||void 0===a.mouseInteraction?{}:a.mouseInteraction,d=[],c=null,getHandler=r=>a=>{let l=getEventTarget(a);if(isBlocked(l,i,s,o,!0))return;let d=null,u=r;if("pointerType"in a){switch(a.pointerType){case"mouse":d=Z.Mouse;break;case"touch":d=Z.Touch;break;case"pen":d=Z.Pen}d===Z.Touch?Q[r]===Q.MouseDown?u="TouchStart":Q[r]===Q.MouseUp&&(u="TouchEnd"):Z.Pen}else legacy_isTouchEvent(a)&&(d=Z.Touch);null!==d?(c=d,(u.startsWith("Touch")&&d===Z.Touch||u.startsWith("Mouse")&&d===Z.Mouse)&&(d=null)):Q[r]===Q.Click&&(d=c,c=null);let h=legacy_isTouchEvent(a)?a.changedTouches[0]:a;if(!h)return;let p=n.getId(l),{clientX:m,clientY:f}=h;callbackWrapper(t)(Object.assign({type:Q[u],id:p,x:m,y:f},null!==d&&{pointerType:d}))};return Object.keys(Q).filter(t=>Number.isNaN(Number(t))&&!t.endsWith("_Departed")&&!1!==l[t]).forEach(t=>{let n=toLowerCase(t),i=getHandler(t);if(window.PointerEvent)switch(Q[t]){case Q.MouseDown:case Q.MouseUp:n=n.replace("mouse","pointer");break;case Q.TouchStart:case Q.TouchEnd:return}d.push(on(n,i,r))}),callbackWrapper(()=>{d.forEach(t=>t())})}function initScrollObserver({scrollCb:t,doc:r,mirror:n,blockClass:i,blockSelector:s,unblockSelector:o,sampling:a}){let l=callbackWrapper(throttle$1(callbackWrapper(a=>{let l=getEventTarget(a);if(!l||isBlocked(l,i,s,o,!0))return;let d=n.getId(l);if(l===r&&r.defaultView){let n=getWindowScroll(r.defaultView);t({id:d,x:n.left,y:n.top})}else t({id:d,x:l.scrollLeft,y:l.scrollTop})}),a.scroll||100));return on("scroll",l,r)}function initViewportResizeObserver({viewportResizeCb:t},{win:r}){let n=-1,i=-1,s=callbackWrapper(throttle$1(callbackWrapper(()=>{let r=getWindowHeight(),s=getWindowWidth();(n!==r||i!==s)&&(t({width:Number(s),height:Number(r)}),n=r,i=s)}),200));return on("resize",s,r)}let et=["INPUT","TEXTAREA","SELECT"],er=new WeakMap;function initInputObserver({inputCb:t,doc:r,mirror:n,blockClass:i,blockSelector:s,unblockSelector:o,ignoreClass:a,ignoreSelector:l,maskInputOptions:d,maskInputFn:c,sampling:u,userTriggeredOnInput:h,maskTextClass:p,unmaskTextClass:m,maskTextSelector:f,unmaskTextSelector:g}){function eventHandler(t){let n=getEventTarget(t),u=t.isTrusted,y=n&&toUpperCase(n.tagName);if("OPTION"===y&&(n=n.parentElement),!n||!y||0>et.indexOf(y)||isBlocked(n,i,s,o,!0))return;let S=n;if(S.classList.contains(a)||l&&S.matches(l))return;let _=getInputType(n),v=getInputValue(S,y,_),b=!1,E=shouldMaskInput({maskInputOptions:d,tagName:y,type:_}),w=needMaskingText(n,p,f,m,g,E);("radio"===_||"checkbox"===_)&&(b=n.checked),v=maskInputValue({isMasked:w,element:n,value:v,maskInputFn:c}),cbWithDedup(n,h?{text:v,isChecked:b,userTriggered:u}:{text:v,isChecked:b});let k=n.name;"radio"===_&&k&&b&&r.querySelectorAll(`input[type="radio"][name="${k}"]`).forEach(t=>{if(t!==n){let r=maskInputValue({isMasked:w,element:t,value:getInputValue(t,y,_),maskInputFn:c});cbWithDedup(t,h?{text:r,isChecked:!b,userTriggered:!1}:{text:r,isChecked:!b})}})}function cbWithDedup(r,i){let s=er.get(r);if(!s||s.text!==i.text||s.isChecked!==i.isChecked){er.set(r,i);let s=n.getId(r);callbackWrapper(t)(Object.assign(Object.assign({},i),{id:s}))}}let y="last"===u.input?["change"]:["input","change"],S=y.map(t=>on(t,callbackWrapper(eventHandler),r)),_=r.defaultView;if(!_)return()=>{S.forEach(t=>t())};let v=_.Object.getOwnPropertyDescriptor(_.HTMLInputElement.prototype,"value"),b=[[_.HTMLInputElement.prototype,"value"],[_.HTMLInputElement.prototype,"checked"],[_.HTMLSelectElement.prototype,"value"],[_.HTMLTextAreaElement.prototype,"value"],[_.HTMLSelectElement.prototype,"selectedIndex"],[_.HTMLOptionElement.prototype,"selected"]];return v&&v.set&&S.push(...b.map(t=>hookSetter(t[0],t[1],{set(){callbackWrapper(eventHandler)({target:this,isTrusted:!1})}},!1,_))),callbackWrapper(()=>{S.forEach(t=>t())})}function getNestedCSSRulePositions(t){return function(t,r){if(hasNestedCSSRule("CSSGroupingRule")&&t.parentRule instanceof CSSGroupingRule||hasNestedCSSRule("CSSMediaRule")&&t.parentRule instanceof CSSMediaRule||hasNestedCSSRule("CSSSupportsRule")&&t.parentRule instanceof CSSSupportsRule||hasNestedCSSRule("CSSConditionRule")&&t.parentRule instanceof CSSConditionRule){let n=Array.from(t.parentRule.cssRules),i=n.indexOf(t);r.unshift(i)}else if(t.parentStyleSheet){let n=Array.from(t.parentStyleSheet.cssRules),i=n.indexOf(t);r.unshift(i)}return r}(t,[])}function getIdAndStyleId(t,r,n){let i,s;return t?(t.ownerNode?i=r.getId(t.ownerNode):s=n.getId(t),{styleId:s,id:i}):{}}function initStyleSheetObserver({styleSheetRuleCb:t,mirror:r,stylesheetManager:n},{win:i}){let s,o;if(!i.CSSStyleSheet||!i.CSSStyleSheet.prototype)return()=>{};let a=i.CSSStyleSheet.prototype.insertRule;i.CSSStyleSheet.prototype.insertRule=new Proxy(a,{apply:callbackWrapper((i,s,o)=>{let[a,l]=o,{id:d,styleId:c}=getIdAndStyleId(s,r,n.styleMirror);return(d&&-1!==d||c&&-1!==c)&&t({id:d,styleId:c,adds:[{rule:a,index:l}]}),i.apply(s,o)})});let l=i.CSSStyleSheet.prototype.deleteRule;i.CSSStyleSheet.prototype.deleteRule=new Proxy(l,{apply:callbackWrapper((i,s,o)=>{let[a]=o,{id:l,styleId:d}=getIdAndStyleId(s,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,removes:[{index:a}]}),i.apply(s,o)})}),i.CSSStyleSheet.prototype.replace&&(s=i.CSSStyleSheet.prototype.replace,i.CSSStyleSheet.prototype.replace=new Proxy(s,{apply:callbackWrapper((i,s,o)=>{let[a]=o,{id:l,styleId:d}=getIdAndStyleId(s,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,replace:a}),i.apply(s,o)})})),i.CSSStyleSheet.prototype.replaceSync&&(o=i.CSSStyleSheet.prototype.replaceSync,i.CSSStyleSheet.prototype.replaceSync=new Proxy(o,{apply:callbackWrapper((i,s,o)=>{let[a]=o,{id:l,styleId:d}=getIdAndStyleId(s,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,replaceSync:a}),i.apply(s,o)})}));let d={};canMonkeyPatchNestedCSSRule("CSSGroupingRule")?d.CSSGroupingRule=i.CSSGroupingRule:(canMonkeyPatchNestedCSSRule("CSSMediaRule")&&(d.CSSMediaRule=i.CSSMediaRule),canMonkeyPatchNestedCSSRule("CSSConditionRule")&&(d.CSSConditionRule=i.CSSConditionRule),canMonkeyPatchNestedCSSRule("CSSSupportsRule")&&(d.CSSSupportsRule=i.CSSSupportsRule));let c={};return Object.entries(d).forEach(([i,s])=>{c[i]={insertRule:s.prototype.insertRule,deleteRule:s.prototype.deleteRule},s.prototype.insertRule=new Proxy(c[i].insertRule,{apply:callbackWrapper((i,s,o)=>{let[a,l]=o,{id:d,styleId:c}=getIdAndStyleId(s.parentStyleSheet,r,n.styleMirror);return(d&&-1!==d||c&&-1!==c)&&t({id:d,styleId:c,adds:[{rule:a,index:[...getNestedCSSRulePositions(s),l||0]}]}),i.apply(s,o)})}),s.prototype.deleteRule=new Proxy(c[i].deleteRule,{apply:callbackWrapper((i,s,o)=>{let[a]=o,{id:l,styleId:d}=getIdAndStyleId(s.parentStyleSheet,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,removes:[{index:[...getNestedCSSRulePositions(s),a]}]}),i.apply(s,o)})})}),callbackWrapper(()=>{i.CSSStyleSheet.prototype.insertRule=a,i.CSSStyleSheet.prototype.deleteRule=l,s&&(i.CSSStyleSheet.prototype.replace=s),o&&(i.CSSStyleSheet.prototype.replaceSync=o),Object.entries(d).forEach(([t,r])=>{r.prototype.insertRule=c[t].insertRule,r.prototype.deleteRule=c[t].deleteRule})})}function initAdoptedStyleSheetObserver({mirror:t,stylesheetManager:r},n){var i,s,o;let a=null;a="#document"===n.nodeName?t.getId(n):t.getId(n.host);let l="#document"===n.nodeName?null===(i=n.defaultView)||void 0===i?void 0:i.Document:null===(o=null===(s=n.ownerDocument)||void 0===s?void 0:s.defaultView)||void 0===o?void 0:o.ShadowRoot,d=(null==l?void 0:l.prototype)?Object.getOwnPropertyDescriptor(null==l?void 0:l.prototype,"adoptedStyleSheets"):void 0;return null!==a&&-1!==a&&l&&d?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:d.configurable,enumerable:d.enumerable,get(){var t;return null===(t=d.get)||void 0===t?void 0:t.call(this)},set(t){var n;let i=null===(n=d.set)||void 0===n?void 0:n.call(this,t);if(null!==a&&-1!==a)try{r.adoptStyleSheets(t,a)}catch(t){}return i}}),callbackWrapper(()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:d.configurable,enumerable:d.enumerable,get:d.get,set:d.set})})):()=>{}}function initStyleDeclarationObserver({styleDeclarationCb:t,mirror:r,ignoreCSSAttributes:n,stylesheetManager:i},{win:s}){let o=s.CSSStyleDeclaration.prototype.setProperty;s.CSSStyleDeclaration.prototype.setProperty=new Proxy(o,{apply:callbackWrapper((s,a,l)=>{var d;let[c,u,h]=l;if(n.has(c))return o.apply(a,[c,u,h]);let{id:p,styleId:m}=getIdAndStyleId(null===(d=a.parentRule)||void 0===d?void 0:d.parentStyleSheet,r,i.styleMirror);return(p&&-1!==p||m&&-1!==m)&&t({id:p,styleId:m,set:{property:c,value:u,priority:h},index:getNestedCSSRulePositions(a.parentRule)}),s.apply(a,l)})});let a=s.CSSStyleDeclaration.prototype.removeProperty;return s.CSSStyleDeclaration.prototype.removeProperty=new Proxy(a,{apply:callbackWrapper((s,o,l)=>{var d;let[c]=l;if(n.has(c))return a.apply(o,[c]);let{id:u,styleId:h}=getIdAndStyleId(null===(d=o.parentRule)||void 0===d?void 0:d.parentStyleSheet,r,i.styleMirror);return(u&&-1!==u||h&&-1!==h)&&t({id:u,styleId:h,remove:{property:c},index:getNestedCSSRulePositions(o.parentRule)}),s.apply(o,l)})}),callbackWrapper(()=>{s.CSSStyleDeclaration.prototype.setProperty=o,s.CSSStyleDeclaration.prototype.removeProperty=a})}function initMediaInteractionObserver({mediaInteractionCb:t,blockClass:r,blockSelector:n,unblockSelector:i,mirror:s,sampling:o,doc:a}){let l=callbackWrapper(a=>throttle$1(callbackWrapper(o=>{let l=getEventTarget(o);if(!l||isBlocked(l,r,n,i,!0))return;let{currentTime:d,volume:c,muted:u,playbackRate:h}=l;t({type:a,id:s.getId(l),currentTime:d,volume:c,muted:u,playbackRate:h})}),o.media||500)),d=[on("play",l(0),a),on("pause",l(1),a),on("seeked",l(2),a),on("volumechange",l(3),a),on("ratechange",l(4),a)];return callbackWrapper(()=>{d.forEach(t=>t())})}function initFontObserver({fontCb:t,doc:r}){let n=r.defaultView;if(!n)return()=>{};let i=[],s=new WeakMap,o=n.FontFace;n.FontFace=function(t,r,n){let i=new o(t,r,n);return s.set(i,{family:t,buffer:"string"!=typeof r,descriptors:n,fontSource:"string"==typeof r?r:JSON.stringify(Array.from(new Uint8Array(r)))}),i};let a=patch(r.fonts,"add",function(r){return function(n){return setTimeout(callbackWrapper(()=>{let r=s.get(n);r&&(t(r),s.delete(n))}),0),r.apply(this,[n])}});return i.push(()=>{n.FontFace=o}),i.push(a),callbackWrapper(()=>{i.forEach(t=>t())})}function initSelectionObserver(t){let{doc:r,mirror:n,blockClass:i,blockSelector:s,unblockSelector:o,selectionCb:a}=t,l=!0,d=callbackWrapper(()=>{let t=r.getSelection();if(!t||l&&(null==t?void 0:t.isCollapsed))return;l=t.isCollapsed||!1;let d=[],c=t.rangeCount||0;for(let r=0;r<c;r++){let a=t.getRangeAt(r),{startContainer:l,startOffset:c,endContainer:u,endOffset:h}=a,p=isBlocked(l,i,s,o,!0)||isBlocked(u,i,s,o,!0);p||d.push({start:n.getId(l),startOffset:c,end:n.getId(u),endOffset:h})}a({ranges:d})});return d(),on("selectionchange",d)}function initCustomElementObserver({doc:t,customElementCb:r}){let n=t.defaultView;if(!n||!n.customElements)return()=>{};let i=patch(n.customElements,"define",function(t){return function(n,i,s){try{r({define:{name:n}})}catch(t){}return t.apply(this,[n,i,s])}});return i}function initObservers(t,r={}){let n=t.doc.defaultView;if(!n)return()=>{};let i=initMutationObserver(t,t.doc),s=initMoveObserver(t),o=initMouseInteractionObserver(t),a=initScrollObserver(t),l=initViewportResizeObserver(t,{win:n}),d=initInputObserver(t),c=initMediaInteractionObserver(t),u=initStyleSheetObserver(t,{win:n}),h=initAdoptedStyleSheetObserver(t,t.doc),p=initStyleDeclarationObserver(t,{win:n}),m=t.collectFonts?initFontObserver(t):()=>{},f=initSelectionObserver(t),g=initCustomElementObserver(t);return callbackWrapper(()=>{ee.forEach(t=>t.reset()),i.disconnect(),s(),o(),a(),l(),d(),c(),u(),h(),p(),m(),f(),g()})}function hasNestedCSSRule(t){return void 0!==window[t]}function canMonkeyPatchNestedCSSRule(t){return!!(void 0!==window[t]&&window[t].prototype&&"insertRule"in window[t].prototype&&"deleteRule"in window[t].prototype)}let CrossOriginIframeMirror=class CrossOriginIframeMirror{constructor(t){this.generateIdFn=t,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(t,r,n,i){let s=n||this.getIdToRemoteIdMap(t),o=i||this.getRemoteIdToIdMap(t),a=s.get(r);return a||(a=this.generateIdFn(),s.set(r,a),o.set(a,r)),a}getIds(t,r){let n=this.getIdToRemoteIdMap(t),i=this.getRemoteIdToIdMap(t);return r.map(r=>this.getId(t,r,n,i))}getRemoteId(t,r,n){let i=n||this.getRemoteIdToIdMap(t);if("number"!=typeof r)return r;let s=i.get(r);return s||-1}getRemoteIds(t,r){let n=this.getRemoteIdToIdMap(t);return r.map(r=>this.getRemoteId(t,r,n))}reset(t){if(!t){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(t),this.iframeRemoteIdToIdMap.delete(t)}getIdToRemoteIdMap(t){let r=this.iframeIdToRemoteIdMap.get(t);return r||(r=new Map,this.iframeIdToRemoteIdMap.set(t,r)),r}getRemoteIdToIdMap(t){let r=this.iframeRemoteIdToIdMap.get(t);return r||(r=new Map,this.iframeRemoteIdToIdMap.set(t,r)),r}};let IframeManagerNoop=class IframeManagerNoop{constructor(){this.crossOriginIframeMirror=new CrossOriginIframeMirror(genId),this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}};let IframeManager=class IframeManager{constructor(t){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new CrossOriginIframeMirror(genId),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=t.mutationCb,this.wrappedEmit=t.wrappedEmit,this.stylesheetManager=t.stylesheetManager,this.recordCrossOriginIframes=t.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=t.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(t){this.iframes.set(t,!0),t.contentWindow&&this.crossOriginIframeMap.set(t.contentWindow,t)}addLoadListener(t){this.loadListener=t}attachIframe(t,r){var n;this.mutationCb({adds:[{parentId:this.mirror.getId(t),nextId:null,node:r}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,t),t.contentDocument&&t.contentDocument.adoptedStyleSheets&&t.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(t.contentDocument.adoptedStyleSheets,this.mirror.getId(t.contentDocument))}handleMessage(t){if("rrweb"!==t.data.type||t.origin!==t.data.origin)return;let r=t.source;if(!r)return;let n=this.crossOriginIframeMap.get(t.source);if(!n)return;let i=this.transformCrossOriginEvent(n,t.data.event);i&&this.wrappedEmit(i,t.data.isCheckout)}transformCrossOriginEvent(t,r){var n;switch(r.type){case X.FullSnapshot:{this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(r.data.node,t);let n=r.data.node.id;return this.crossOriginIframeRootIdMap.set(t,n),this.patchRootIdOnNode(r.data.node,n),{timestamp:r.timestamp,type:X.IncrementalSnapshot,data:{source:J.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:r.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case X.Meta:case X.Load:case X.DomContentLoaded:break;case X.Plugin:return r;case X.Custom:return this.replaceIds(r.data.payload,t,["id","parentId","previousId","nextId"]),r;case X.IncrementalSnapshot:switch(r.data.source){case J.Mutation:return r.data.adds.forEach(r=>{this.replaceIds(r,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(r.node,t);let n=this.crossOriginIframeRootIdMap.get(t);n&&this.patchRootIdOnNode(r.node,n)}),r.data.removes.forEach(r=>{this.replaceIds(r,t,["parentId","id"])}),r.data.attributes.forEach(r=>{this.replaceIds(r,t,["id"])}),r.data.texts.forEach(r=>{this.replaceIds(r,t,["id"])}),r;case J.Drag:case J.TouchMove:case J.MouseMove:return r.data.positions.forEach(r=>{this.replaceIds(r,t,["id"])}),r;case J.ViewportResize:return!1;case J.MediaInteraction:case J.MouseInteraction:case J.Scroll:case J.CanvasMutation:case J.Input:return this.replaceIds(r.data,t,["id"]),r;case J.StyleSheetRule:case J.StyleDeclaration:return this.replaceIds(r.data,t,["id"]),this.replaceStyleIds(r.data,t,["styleId"]),r;case J.Font:return r;case J.Selection:return r.data.ranges.forEach(r=>{this.replaceIds(r,t,["start","end"])}),r;case J.AdoptedStyleSheet:return this.replaceIds(r.data,t,["id"]),this.replaceStyleIds(r.data,t,["styleIds"]),null===(n=r.data.styles)||void 0===n||n.forEach(r=>{this.replaceStyleIds(r,t,["styleId"])}),r}}return!1}replace(t,r,n,i){for(let s of i)(Array.isArray(r[s])||"number"==typeof r[s])&&(Array.isArray(r[s])?r[s]=t.getIds(n,r[s]):r[s]=t.getId(n,r[s]));return r}replaceIds(t,r,n){return this.replace(this.crossOriginIframeMirror,t,r,n)}replaceStyleIds(t,r,n){return this.replace(this.crossOriginIframeStyleMirror,t,r,n)}replaceIdOnNode(t,r){this.replaceIds(t,r,["id","rootId"]),"childNodes"in t&&t.childNodes.forEach(t=>{this.replaceIdOnNode(t,r)})}patchRootIdOnNode(t,r){t.type===f.Document||t.rootId||(t.rootId=r),"childNodes"in t&&t.childNodes.forEach(t=>{this.patchRootIdOnNode(t,r)})}};let ShadowDomManagerNoop=class ShadowDomManagerNoop{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}};let ShadowDomManager=class ShadowDomManager{constructor(t){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(t,r){if(!isNativeShadowDom(t)||this.shadowDoms.has(t))return;this.shadowDoms.add(t);let n=initMutationObserver(Object.assign(Object.assign({},this.bypassOptions),{doc:r,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t);this.restoreHandlers.push(()=>n.disconnect()),this.restoreHandlers.push(initScrollObserver(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror}))),setTimeout(()=>{t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(t.adoptedStyleSheets,this.mirror.getId(t.host)),this.restoreHandlers.push(initAdoptedStyleSheetObserver({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},t))},0)}observeAttachShadow(t){t.contentWindow&&t.contentDocument&&this.patchAttachShadow(t.contentWindow.Element,t.contentDocument)}patchAttachShadow(t,r){let n=this;this.restoreHandlers.push(patch(t.prototype,"attachShadow",function(t){return function(i){let s=t.call(this,i);return this.shadowRoot&&inDom(this)&&n.addShadowRoot(this.shadowRoot,r),s}}))}reset(){this.restoreHandlers.forEach(t=>{try{t()}catch(t){}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}};let CanvasManagerNoop=class CanvasManagerNoop{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}};let StylesheetManager=class StylesheetManager{constructor(t){this.trackedLinkElements=new WeakSet,this.styleMirror=new StyleSheetMirror,this.mutationCb=t.mutationCb,this.adoptedStyleSheetCb=t.adoptedStyleSheetCb}attachLinkElement(t,r){"_cssText"in r.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:r.id,attributes:r.attributes}]}),this.trackLinkElement(t)}trackLinkElement(t){this.trackedLinkElements.has(t)||(this.trackedLinkElements.add(t),this.trackStylesheetInLinkElement(t))}adoptStyleSheets(t,r){if(0===t.length)return;let n={id:r,styleIds:[]},i=[];for(let r of t){let t;this.styleMirror.has(r)?t=this.styleMirror.getId(r):(t=this.styleMirror.add(r),i.push({styleId:t,rules:Array.from(r.rules||CSSRule,(t,r)=>({rule:stringifyRule(t),index:r}))})),n.styleIds.push(t)}i.length>0&&(n.styles=i),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(t){}};let ProcessedNodeManager=class ProcessedNodeManager{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){requestAnimationFrame(()=>{this.clear(),this.loop&&this.periodicallyClear()})}inOtherBuffer(t,r){let n=this.nodeMap.get(t);return n&&Array.from(n).some(t=>t!==r)}add(t,r){this.nodeMap.set(t,(this.nodeMap.get(t)||new Set).add(r))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}};function wrapEvent(t){return t.timestamp=K(),t}let en=createMirror();function record(t={}){let r;let{emit:n,checkoutEveryNms:i,checkoutEveryNth:s,blockClass:o="rr-block",blockSelector:l=null,unblockSelector:d=null,ignoreClass:c="rr-ignore",ignoreSelector:u=null,maskAllText:h=!1,maskTextClass:p="rr-mask",unmaskTextClass:m=null,maskTextSelector:f=null,unmaskTextSelector:g=null,inlineStylesheet:y=!0,maskAllInputs:S,maskInputOptions:_,slimDOMOptions:v,maskAttributeFn:b,maskInputFn:E,maskTextFn:w,packFn:k,sampling:I={},dataURLOptions:R={},mousemoveWait:M,recordCanvas:T=!1,recordCrossOriginIframes:C=!1,recordAfter:x="DOMContentLoaded"===t.recordAfter?t.recordAfter:"load",userTriggeredOnInput:N=!1,collectFonts:D=!1,inlineImages:O=!1,keepIframeSrcFn:A=()=>!1,ignoreCSSAttributes:B=new Set([]),errorHandler:L,onMutation:P,getCanvasManager:F}=t;registerErrorHandler(L);let W=!C||window.parent===window,U=!1;if(!W)try{window.parent.document&&(U=!1)}catch(t){U=!0}if(W&&!n)throw Error("emit function is required");void 0!==M&&void 0===I.mousemove&&(I.mousemove=M),en.reset();let z=!0===S?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:void 0!==_?_:{},H=!0===v||"all"===v?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===v,headMetaDescKeywords:"all"===v}:v||{};polyfill();let j=0,eventProcessor=t=>(k&&!U&&(t=k(t)),t),wrappedEmit=(t,o)=>{var a;if((null===(a=ee[0])||void 0===a?void 0:a.isFrozen())&&t.type!==X.FullSnapshot&&!(t.type===X.IncrementalSnapshot&&t.data.source===J.Mutation)&&ee.forEach(t=>t.unfreeze()),W)null==n||n(eventProcessor(t),o);else if(U){let r={type:"rrweb",event:eventProcessor(t),origin:window.location.origin,isCheckout:o};window.parent.postMessage(r,"*")}if(t.type===X.FullSnapshot)r=t,j=0;else if(t.type===X.IncrementalSnapshot){if(t.data.source===J.Mutation&&t.data.isAttachIframe)return;j++;let n=s&&j>=s,o=i&&t.timestamp-r.timestamp>i;(n||o)&&takeFullSnapshot(!0)}},wrappedMutationEmit=t=>{wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.Mutation},t)}))},wrappedScrollEmit=t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.Scroll},t)})),wrappedCanvasMutationEmit=t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.CanvasMutation},t)})),G=new StylesheetManager({mutationCb:wrappedMutationEmit,adoptedStyleSheetCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.AdoptedStyleSheet},t)}))}),$="boolean"==typeof __RRWEB_EXCLUDE_IFRAME__&&__RRWEB_EXCLUDE_IFRAME__?new IframeManagerNoop:new IframeManager({mirror:en,mutationCb:wrappedMutationEmit,stylesheetManager:G,recordCrossOriginIframes:C,wrappedEmit}),q=new ProcessedNodeManager,Y=F?F({recordCanvas:T,blockClass:o,blockSelector:l,unblockSelector:d,sampling:I.canvas,dataURLOptions:R}):new CanvasManagerNoop,V="boolean"==typeof __RRWEB_EXCLUDE_SHADOW_DOM__&&__RRWEB_EXCLUDE_SHADOW_DOM__?new ShadowDomManagerNoop:new ShadowDomManager({mutationCb:wrappedMutationEmit,scrollCb:wrappedScrollEmit,bypassOptions:{onMutation:P,blockClass:o,blockSelector:l,unblockSelector:d,maskAllText:h,maskTextClass:p,unmaskTextClass:m,maskTextSelector:f,unmaskTextSelector:g,inlineStylesheet:y,maskInputOptions:z,dataURLOptions:R,maskAttributeFn:b,maskTextFn:w,maskInputFn:E,recordCanvas:T,inlineImages:O,sampling:I,slimDOMOptions:H,iframeManager:$,stylesheetManager:G,canvasManager:Y,keepIframeSrcFn:A,processedNodeManager:q},mirror:en}),takeFullSnapshot=(t=!1)=>{wrappedEmit(wrapEvent({type:X.Meta,data:{href:window.location.href,width:getWindowWidth(),height:getWindowHeight()}}),t),G.reset(),V.init(),ee.forEach(t=>t.lock());let r=snapshot(document,{mirror:en,blockClass:o,blockSelector:l,unblockSelector:d,maskAllText:h,maskTextClass:p,unmaskTextClass:m,maskTextSelector:f,unmaskTextSelector:g,inlineStylesheet:y,maskAllInputs:z,maskAttributeFn:b,maskInputFn:E,maskTextFn:w,slimDOM:H,dataURLOptions:R,recordCanvas:T,inlineImages:O,onSerialize:t=>{isSerializedIframe(t,en)&&$.addIframe(t),isSerializedStylesheet(t,en)&&G.trackLinkElement(t),hasShadowRoot(t)&&V.addShadowRoot(t.shadowRoot,document)},onIframeLoad:(t,r)=>{$.attachIframe(t,r),V.observeAttachShadow(t)},onStylesheetLoad:(t,r)=>{G.attachLinkElement(t,r)},keepIframeSrcFn:A});if(!r)return console.warn("Failed to snapshot the document");wrappedEmit(wrapEvent({type:X.FullSnapshot,data:{node:r,initialOffset:getWindowScroll(window)}}),t),ee.forEach(t=>t.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&G.adoptStyleSheets(document.adoptedStyleSheets,en.getId(document))};a=takeFullSnapshot;try{let t=[],observe=t=>callbackWrapper(initObservers)({onMutation:P,mutationCb:wrappedMutationEmit,mousemoveCb:(t,r)=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:{source:r,positions:t}})),mouseInteractionCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.MouseInteraction},t)})),scrollCb:wrappedScrollEmit,viewportResizeCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.ViewportResize},t)})),inputCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.Input},t)})),mediaInteractionCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.MediaInteraction},t)})),styleSheetRuleCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.StyleSheetRule},t)})),styleDeclarationCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.StyleDeclaration},t)})),canvasMutationCb:wrappedCanvasMutationEmit,fontCb:t=>wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.Font},t)})),selectionCb:t=>{wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.Selection},t)}))},customElementCb:t=>{wrappedEmit(wrapEvent({type:X.IncrementalSnapshot,data:Object.assign({source:J.CustomElement},t)}))},blockClass:o,ignoreClass:c,ignoreSelector:u,maskAllText:h,maskTextClass:p,unmaskTextClass:m,maskTextSelector:f,unmaskTextSelector:g,maskInputOptions:z,inlineStylesheet:y,sampling:I,recordCanvas:T,inlineImages:O,userTriggeredOnInput:N,collectFonts:D,doc:t,maskAttributeFn:b,maskInputFn:E,maskTextFn:w,keepIframeSrcFn:A,blockSelector:l,unblockSelector:d,slimDOMOptions:H,dataURLOptions:R,mirror:en,iframeManager:$,stylesheetManager:G,shadowDomManager:V,processedNodeManager:q,canvasManager:Y,ignoreCSSAttributes:B,plugins:[]},{});$.addLoadListener(r=>{try{t.push(observe(r.contentDocument))}catch(t){console.warn(t)}});let init=()=>{takeFullSnapshot(),t.push(observe(document))};return"interactive"===document.readyState||"complete"===document.readyState?init():(t.push(on("DOMContentLoaded",()=>{wrappedEmit(wrapEvent({type:X.DomContentLoaded,data:{}})),"DOMContentLoaded"===x&&init()})),t.push(on("load",()=>{wrappedEmit(wrapEvent({type:X.Load,data:{}})),"load"===x&&init()},window))),()=>{t.forEach(t=>t()),q.destroy(),a=void 0,unregisterErrorHandler()}}catch(t){console.warn(t)}}function takeFullSnapshot(t){if(!a)throw Error("please take full snapshot after start recording");a(t)}function timestampToMs(t){return t>9999999999?t:1e3*t}function timestampToS(t){return t>9999999999?t/1e3:t}function addBreadcrumbEvent(t,r){"sentry.transaction"!==r.category&&(["ui.click","ui.input"].includes(r.category)?t.triggerUserActivity():t.checkAndHandleExpiredSession(),t.addUpdate(()=>(t.throttledAddEvent({type:X.Custom,timestamp:1e3*(r.timestamp||0),data:{tag:"breadcrumb",payload:(0,w.Fv)(r,10,1e3)}}),"console"===r.category)))}function getClosestInteractive(t){let r=t.closest("button,a");return r||t}function getClickTargetNode(t){let r=getTargetNode(t);return r&&r instanceof Element?getClosestInteractive(r):r}function getTargetNode(t){return isEventWithTarget(t)?t.target:t}function isEventWithTarget(t){return"object"==typeof t&&!!t&&"target"in t}function onWindowOpen(t){return l||(l=[],monkeyPatchWindowOpen()),l.push(t),()=>{let r=l?l.indexOf(t):-1;r>-1&&l.splice(r,1)}}function monkeyPatchWindowOpen(){(0,k.hl)(B,"open",function(t){return function(...r){if(l)try{l.forEach(t=>t())}catch(t){}return t.apply(B,r)}})}function handleClick(t,r,n){t.handleClick(r,n)}record.mirror=en,record.takeFullSnapshot=takeFullSnapshot;let ClickDetector=class ClickDetector{constructor(t,r,n=addBreadcrumbEvent){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=r.timeout/1e3,this._threshold=r.threshold/1e3,this._scollTimeout=r.scrollTimeout/1e3,this._replay=t,this._ignoreSelector=r.ignoreSelector,this._addBreadcrumbEvent=n}addListeners(){let t=onWindowOpen(()=>{this._lastMutation=nowInSeconds()});this._teardown=()=>{t(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(t,r){if(ignoreElement(r,this._ignoreSelector)||!isClickBreadcrumb(t))return;let n={timestamp:timestampToS(t.timestamp),clickBreadcrumb:t,clickCount:0,node:r};this._clicks.some(t=>t.node===n.node&&1>Math.abs(t.timestamp-n.timestamp))||(this._clicks.push(n),1===this._clicks.length&&this._scheduleCheckClicks())}registerMutation(t=Date.now()){this._lastMutation=timestampToS(t)}registerScroll(t=Date.now()){this._lastScroll=timestampToS(t)}registerClick(t){let r=getClosestInteractive(t);this._handleMultiClick(r)}_handleMultiClick(t){this._getClicks(t).forEach(t=>{t.clickCount++})}_getClicks(t){return this._clicks.filter(r=>r.node===t)}_checkClicks(){let t=[],r=nowInSeconds();for(let n of(this._clicks.forEach(n=>{!n.mutationAfter&&this._lastMutation&&(n.mutationAfter=n.timestamp<=this._lastMutation?this._lastMutation-n.timestamp:void 0),!n.scrollAfter&&this._lastScroll&&(n.scrollAfter=n.timestamp<=this._lastScroll?this._lastScroll-n.timestamp:void 0),n.timestamp+this._timeout<=r&&t.push(n)}),t)){let t=this._clicks.indexOf(n);t>-1&&(this._generateBreadcrumbs(n),this._clicks.splice(t,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(t){let r=this._replay,n=t.scrollAfter&&t.scrollAfter<=this._scollTimeout,i=t.mutationAfter&&t.mutationAfter<=this._threshold,{clickCount:s,clickBreadcrumb:o}=t;if(!n&&!i){let n=1e3*Math.min(t.mutationAfter||this._timeout,this._timeout),i=n<1e3*this._timeout?"mutation":"timeout",a={type:"default",message:o.message,timestamp:o.timestamp,category:"ui.slowClickDetected",data:{...o.data,url:B.location.href,route:r.getCurrentRoute(),timeAfterClickMs:n,endReason:i,clickCount:s||1}};this._addBreadcrumbEvent(r,a);return}if(s>1){let t={type:"default",message:o.message,timestamp:o.timestamp,category:"ui.multiClick",data:{...o.data,url:B.location.href,route:r.getCurrentRoute(),clickCount:s,metric:!0}};this._addBreadcrumbEvent(r,t)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=setTimeout(()=>this._checkClicks(),1e3)}};let ei=["A","BUTTON","INPUT"];function ignoreElement(t,r){return!!(!ei.includes(t.tagName)||"INPUT"===t.tagName&&!["submit","button"].includes(t.getAttribute("type")||"")||"A"===t.tagName&&(t.hasAttribute("download")||t.hasAttribute("target")&&"_self"!==t.getAttribute("target"))||r&&t.matches(r))}function isClickBreadcrumb(t){return!!(t.data&&"number"==typeof t.data.nodeId&&t.timestamp)}function nowInSeconds(){return Date.now()/1e3}function updateClickDetectorForRecordingEvent(t,r){try{if(!isIncrementalEvent(r))return;let{source:n}=r.data;if(n===J.Mutation&&t.registerMutation(r.timestamp),n===J.Scroll&&t.registerScroll(r.timestamp),isIncrementalMouseInteraction(r)){let{type:n,id:i}=r.data,s=record.mirror.getNode(i);s instanceof HTMLElement&&n===Q.Click&&t.registerClick(s)}}catch(t){}}function isIncrementalEvent(t){return 3===t.type}function isIncrementalMouseInteraction(t){return t.data.source===J.MouseInteraction}function createBreadcrumb(t){return{timestamp:Date.now()/1e3,type:"default",...t}}(m=g||(g={}))[m.Document=0]="Document",m[m.DocumentType=1]="DocumentType",m[m.Element=2]="Element",m[m.Text=3]="Text",m[m.CDATA=4]="CDATA",m[m.Comment=5]="Comment";let es=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled"]);function getAttributesToRecord(t){let r={};for(let n in t)if(es.has(n)){let i=n;("data-testid"===n||"data-test-id"===n)&&(i="testId"),r[i]=t[n]}return r}let handleDomListener=t=>r=>{if(!t.isEnabled())return;let n=handleDom(r);if(!n)return;let i="click"===r.name,s=i&&r.event;!i||!t.clickDetector||!s||s.altKey||s.metaKey||s.ctrlKey||s.shiftKey||handleClick(t.clickDetector,n,getClickTargetNode(r.event)),addBreadcrumbEvent(t,n)};function getBaseDomBreadcrumb(t,r){let n=record.mirror.getId(t),i=n&&record.mirror.getNode(n),s=i&&record.mirror.getMeta(i),o=s&&isElement(s)?s:null;return{message:r,data:o?{nodeId:n,node:{id:n,tagName:o.tagName,textContent:Array.from(o.childNodes).map(t=>t.type===g.Text&&t.textContent).filter(Boolean).map(t=>t.trim()).join(""),attributes:getAttributesToRecord(o.attributes)}}:{}}}function handleDom(t){let{target:r,message:n}=getDomTarget(t);return createBreadcrumb({category:`ui.${t.name}`,...getBaseDomBreadcrumb(r,n)})}function getDomTarget(t){let r;let n="click"===t.name,i=null;try{i=n?getClickTargetNode(t.event):getTargetNode(t.event),r=(0,I.Rt)(i,{maxStringLength:200})||"<unknown>"}catch(t){r="<unknown>"}return{target:i,message:r}}function isElement(t){return t.type===g.Element}function handleKeyboardEvent(t,r){if(!t.isEnabled())return;t.updateUserActivity();let n=getKeyboardBreadcrumb(r);n&&addBreadcrumbEvent(t,n)}function getKeyboardBreadcrumb(t){let{metaKey:r,shiftKey:n,ctrlKey:i,altKey:s,key:o,target:a}=t;if(!a||isInputElement(a)||!o)return null;let l=1===o.length;if(!(r||i||s)&&l)return null;let d=(0,I.Rt)(a,{maxStringLength:200})||"<unknown>",c=getBaseDomBreadcrumb(a,d);return createBreadcrumb({category:"ui.keyDown",message:d,data:{...c.data,metaKey:r,shiftKey:n,ctrlKey:i,altKey:s,key:o}})}function isInputElement(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable}let eo={resource:createResourceEntry,paint:createPaintEntry,navigation:createNavigationEntry};function createPerformanceEntries(t){return t.map(createPerformanceEntry).filter(Boolean)}function createPerformanceEntry(t){return eo[t.entryType]?eo[t.entryType](t):null}function getAbsoluteTime(t){return((R.Z1||B.performance.timeOrigin)+t)/1e3}function createPaintEntry(t){let{duration:r,entryType:n,name:i,startTime:s}=t,o=getAbsoluteTime(s);return{type:n,name:i,start:o,end:o+r,data:void 0}}function createNavigationEntry(t){let{entryType:r,name:n,decodedBodySize:i,duration:s,domComplete:o,encodedBodySize:a,domContentLoadedEventStart:l,domContentLoadedEventEnd:d,domInteractive:c,loadEventStart:u,loadEventEnd:h,redirectCount:p,startTime:m,transferSize:f,type:g}=t;return 0===s?null:{type:`${r}.${g}`,start:getAbsoluteTime(m),end:getAbsoluteTime(o),name:n,data:{size:f,decodedBodySize:i,encodedBodySize:a,duration:s,domInteractive:c,domContentLoadedEventStart:l,domContentLoadedEventEnd:d,loadEventStart:u,loadEventEnd:h,domComplete:o,redirectCount:p}}}function createResourceEntry(t){let{entryType:r,initiatorType:n,name:i,responseEnd:s,startTime:o,decodedBodySize:a,encodedBodySize:l,responseStatus:d,transferSize:c}=t;return["fetch","xmlhttprequest"].includes(n)?null:{type:`${r}.${n}`,start:getAbsoluteTime(o),end:getAbsoluteTime(s),name:i,data:{size:c,statusCode:d,decodedBodySize:a,encodedBodySize:l}}}function getLargestContentfulPaint(t){let r=t.entries,n=r[r.length-1],i=n?n.element:void 0,s=t.value,o=getAbsoluteTime(s),a={type:"largest-contentful-paint",name:"largest-contentful-paint",start:o,end:o,data:{value:s,size:s,nodeId:i?record.mirror.getId(i):void 0}};return a}function setupPerformanceObserver(t){function addPerformanceEntry(r){t.performanceEntries.includes(r)||t.performanceEntries.push(r)}function onEntries({entries:t}){t.forEach(addPerformanceEntry)}let r=[];return["navigation","paint","resource"].forEach(t=>{r.push((0,A._j)(t,onEntries))}),r.push((0,A.$A)(({metric:r})=>{t.replayPerformanceEntries.push(getLargestContentfulPaint(r))})),()=>{r.forEach(t=>t())}}function e(){let t=new Blob(['var t=Uint8Array,n=Uint16Array,r=Int32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,e){for(var i=new n(31),a=0;a<31;++a)i[a]=e+=1<<t[a-1];var s=new r(i[30]);for(a=1;a<30;++a)for(var o=i[a];o<i[a+1];++o)s[o]=o-i[a]<<5|a;return{b:i,r:s}},o=s(e,2),f=o.b,h=o.r;f[28]=258,h[258]=28;for(var l=s(i,0).r,u=new n(32768),c=0;c<32768;++c){var v=(43690&c)>>1|(21845&c)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,u[c]=((65280&v)>>8|(255&v)<<8)>>1}var d=function(t,r,e){for(var i=t.length,a=0,s=new n(r);a<i;++a)t[a]&&++s[t[a]-1];var o,f=new n(r);for(a=1;a<r;++a)f[a]=f[a-1]+s[a-1]<<1;if(e){o=new n(1<<r);var h=15-r;for(a=0;a<i;++a)if(t[a])for(var l=a<<4|t[a],c=r-t[a],v=f[t[a]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)o[u[v]>>h]=l}else for(o=new n(i),a=0;a<i;++a)t[a]&&(o[a]=u[f[t[a]-1]++]>>15-t[a]);return o},g=new t(288);for(c=0;c<144;++c)g[c]=8;for(c=144;c<256;++c)g[c]=9;for(c=256;c<280;++c)g[c]=7;for(c=280;c<288;++c)g[c]=8;var w=new t(32);for(c=0;c<32;++c)w[c]=5;var p=d(g,9,0),y=d(w,5,0),m=function(t){return(t+7)/8|0},b=function(n,r,e){return(null==r||r<0)&&(r=0),(null==e||e>n.length)&&(e=n.length),new t(n.subarray(r,e))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,n,r){var e=new Error(n||M[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,E),!r)throw e;return e},z=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8},A=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8,t[e+2]|=r>>16},_=function(r,e){for(var i=[],a=0;a<r.length;++a)r[a]&&i.push({s:a,f:r[a]});var s=i.length,o=i.slice();if(!s)return{t:F,l:0};if(1==s){var f=new t(i[0].s+1);return f[i[0].s]=1,{t:f,l:1}}i.sort((function(t,n){return t.f-n.f})),i.push({s:-1,f:25001});var h=i[0],l=i[1],u=0,c=1,v=2;for(i[0]={s:-1,f:h.f+l.f,l:h,r:l};c!=s-1;)h=i[i[u].f<i[v].f?u++:v++],l=i[u!=c&&i[u].f<i[v].f?u++:v++],i[c++]={s:-1,f:h.f+l.f,l:h,r:l};var d=o[0].s;for(a=1;a<s;++a)o[a].s>d&&(d=o[a].s);var g=new n(d+1),w=x(i[c-1],g,0);if(w>e){a=0;var p=0,y=w-e,m=1<<y;for(o.sort((function(t,n){return g[n.s]-g[t.s]||t.f-n.f}));a<s;++a){var b=o[a].s;if(!(g[b]>e))break;p+=m-(1<<w-g[b]),g[b]=e}for(p>>=y;p>0;){var M=o[a].s;g[M]<e?p-=1<<e-g[M]++-1:++a}for(;a>=0&&p;--a){var E=o[a].s;g[E]==e&&(--g[E],++p)}w=e}return{t:new t(g),l:w}},x=function(t,n,r){return-1==t.s?Math.max(x(t.l,n,r+1),x(t.r,n,r+1)):n[t.s]=r},D=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new n(++r),i=0,a=t[0],s=1,o=function(t){e[i++]=t},f=1;f<=r;++f)if(t[f]==a&&f!=r)++s;else{if(!a&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(a),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(a);s=1,a=t[f]}return{c:e.subarray(0,i),n:r}},T=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},k=function(t,n,r){var e=r.length,i=m(n+2);t[i]=255&e,t[i+1]=e>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<e;++a)t[i+a+4]=r[a];return 8*(i+4+e)},C=function(t,r,s,o,f,h,l,u,c,v,m){z(r,m++,s),++f[256];for(var b=_(f,15),M=b.t,E=b.l,x=_(h,15),C=x.t,U=x.l,F=D(M),I=F.c,S=F.n,L=D(C),O=L.c,j=L.n,q=new n(19),B=0;B<I.length;++B)++q[31&I[B]];for(B=0;B<O.length;++B)++q[31&O[B]];for(var G=_(q,7),H=G.t,J=G.l,K=19;K>4&&!H[a[K-1]];--K);var N,P,Q,R,V=v+5<<3,W=T(f,g)+T(h,w)+l,X=T(f,M)+T(h,C)+l+14+3*K+T(q,H)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&V<=W&&V<=X)return k(r,m,t.subarray(c,c+v));if(z(r,m,1+(X<W)),m+=2,X<W){N=d(M,E,0),P=M,Q=d(C,U,0),R=C;var Y=d(H,J,0);z(r,m,S-257),z(r,m+5,j-1),z(r,m+10,K-4),m+=14;for(B=0;B<K;++B)z(r,m+3*B,H[a[B]]);m+=3*K;for(var Z=[I,O],$=0;$<2;++$){var tt=Z[$];for(B=0;B<tt.length;++B){var nt=31&tt[B];z(r,m,Y[nt]),m+=H[nt],nt>15&&(z(r,m,tt[B]>>5&127),m+=tt[B]>>12)}}}else N=p,P=g,Q=y,R=w;for(B=0;B<u;++B){var rt=o[B];if(rt>255){A(r,m,N[(nt=rt>>18&31)+257]),m+=P[nt+257],nt>7&&(z(r,m,rt>>23&31),m+=e[nt]);var et=31&rt;A(r,m,Q[et]),m+=R[et],et>3&&(A(r,m,rt>>5&8191),m+=i[et])}else A(r,m,N[rt]),m+=P[rt]}return A(r,m,N[256]),m+P[256]},U=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new t(0),I=function(){for(var t=new Int32Array(256),n=0;n<256;++n){for(var r=n,e=9;--e;)r=(1&r&&-306674912)^r>>>1;t[n]=r}return t}(),S=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,a=0|r.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=e+=r[s];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(n%=65521))<<8|n>>8}}},L=function(a,s,o,f,u){if(!u&&(u={l:1},s.dictionary)){var c=s.dictionary.subarray(-32768),v=new t(c.length+a.length);v.set(c),v.set(a,c.length),a=v,u.w=c.length}return function(a,s,o,f,u,c){var v=c.z||a.length,d=new t(f+v+5*(1+Math.ceil(v/7e3))+u),g=d.subarray(f,d.length-u),w=c.l,p=7&(c.r||0);if(s){p&&(g[0]=c.r>>3);for(var y=U[s-1],M=y>>13,E=8191&y,z=(1<<o)-1,A=c.p||new n(32768),_=c.h||new n(z+1),x=Math.ceil(o/3),D=2*x,T=function(t){return(a[t]^a[t+1]<<x^a[t+2]<<D)&z},F=new r(25e3),I=new n(288),S=new n(32),L=0,O=0,j=c.i||0,q=0,B=c.w||0,G=0;j+2<v;++j){var H=T(j),J=32767&j,K=_[H];if(A[J]=K,_[H]=J,B<=j){var N=v-j;if((L>7e3||q>24576)&&(N>423||!w)){p=C(a,g,0,F,I,S,O,q,G,j-G,p),q=L=O=0,G=j;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)S[P]=0}var Q=2,R=0,V=E,W=J-K&32767;if(N>2&&H==T(j-W))for(var X=Math.min(M,N)-1,Y=Math.min(32767,j),Z=Math.min(258,N);W<=Y&&--V&&J!=K;){if(a[j+Q]==a[j+Q-W]){for(var $=0;$<Z&&a[j+$]==a[j+$-W];++$);if($>Q){if(Q=$,R=W,$>X)break;var tt=Math.min(W,$-2),nt=0;for(P=0;P<tt;++P){var rt=j-W+P&32767,et=rt-A[rt]&32767;et>nt&&(nt=et,K=rt)}}}W+=(J=K)-(K=A[J])&32767}if(R){F[q++]=268435456|h[Q]<<18|l[R];var it=31&h[Q],at=31&l[R];O+=e[it]+i[at],++I[257+it],++S[at],B=j+Q,++L}else F[q++]=a[j],++I[a[j]]}}for(j=Math.max(j,B);j<v;++j)F[q++]=a[j],++I[a[j]];p=C(a,g,w,F,I,S,O,q,G,j-G,p),w||(c.r=7&p|g[p/8|0]<<3,p-=7,c.h=_,c.p=A,c.i=j,c.w=B)}else{for(j=c.w||0;j<v+w;j+=65535){var st=j+65535;st>=v&&(g[p/8|0]=w,st=v),p=k(g,p+1,a.subarray(j,st))}c.i=v}return b(d,0,f+m(p)+u)}(a,null==s.level?6:s.level,null==s.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+s.mem,o,f,u)},O=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},j=function(){function n(n,r){if("function"==typeof n&&(r=n,n={}),this.ondata=r,this.o=n||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new t(98304),this.o.dictionary){var e=this.o.dictionary.subarray(-32768);this.b.set(e,32768-e.length),this.s.i=32768-e.length}}return n.prototype.p=function(t,n){this.ondata(L(t,this.o,0,0,this.s),n)},n.prototype.push=function(n,r){this.ondata||E(5),this.s.l&&E(4);var e=n.length+this.s.z;if(e>this.b.length){if(e>2*this.b.length-32768){var i=new t(-32768&e);i.set(this.b.subarray(0,this.s.z)),this.b=i}var a=this.b.length-this.s.z;a&&(this.b.set(n.subarray(0,a),this.s.z),this.s.z=this.b.length,this.p(this.b,!1)),this.b.set(this.b.subarray(-32768)),this.b.set(n.subarray(a),32768),this.s.z=n.length-a+32768,this.s.i=32766,this.s.w=32768}else this.b.set(n,this.s.z),this.s.z+=n.length;this.s.l=1&r,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},n}();function q(t,n){n||(n={});var r=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=I[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}}(),e=t.length;r.p(t);var i,a=L(t,n,10+((i=n).filename?i.filename.length+1:0),8),s=a.length;return function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&O(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}}(a,n),O(a,s-8,r.d()),O(a,s-4,e),a}var B=function(){function t(t,n){this.c=S(),this.v=1,j.call(this,t,n)}return t.prototype.push=function(t,n){this.c.p(t),j.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){var r=L(t,this.o,this.v&&(this.o.dictionary?6:2),n&&4,this.s);this.v&&(function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=e<<6|(n.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,n.dictionary){var i=S();i.p(n.dictionary),O(t,2,i.d())}}(r,this.o),this.v=0),n&&O(r,r.length-4,this.c.d()),this.ondata(r,n)},t}(),G="undefined"!=typeof TextEncoder&&new TextEncoder,H="undefined"!=typeof TextDecoder&&new TextDecoder;try{H.decode(F,{stream:!0})}catch(t){}var J=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){this.ondata||E(5),this.d&&E(4),this.ondata(K(t),this.d=n||!1)},t}();function K(n,r){if(r){for(var e=new t(n.length),i=0;i<n.length;++i)e[i]=n.charCodeAt(i);return e}if(G)return G.encode(n);var a=n.length,s=new t(n.length+(n.length>>1)),o=0,f=function(t){s[o++]=t};for(i=0;i<a;++i){if(o+5>s.length){var h=new t(o+8+(a-i<<1));h.set(s),s=h}var l=n.charCodeAt(i);l<128||r?f(l):l<2048?(f(192|l>>6),f(128|63&l)):l>55295&&l<57344?(f(240|(l=65536+(1047552&l)|1023&n.charCodeAt(++i))>>18),f(128|l>>12&63),f(128|l>>6&63),f(128|63&l)):(f(224|l>>12),f(128|l>>6&63),f(128|63&l))}return b(s,0,o)}const N=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const n=this._hasEvents?",":"";this.stream.push(n+t),this._hasEvents=!0}finish(){this.stream.push("]",!0);const t=function(t){let n=0;for(let r=0,e=t.length;r<e;r++)n+=t[r].length;const r=new Uint8Array(n);for(let n=0,e=0,i=t.length;n<i;n++){const i=t[n];r.set(i,e),e+=i.length}return r}(this._deflatedData);return this._init(),t}_init(){this._hasEvents=!1,this._deflatedData=[],this.deflate=new B,this.deflate.ondata=(t,n)=>{this._deflatedData.push(t)},this.stream=new J(((t,n)=>{this.deflate.push(t,n)})),this.stream.push("[")}},P={clear:()=>{N.clear()},addEvent:t=>N.addEvent(t),finish:()=>N.finish(),compress:t=>function(t){return q(K(t))}(t)};addEventListener("message",(function(t){const n=t.data.method,r=t.data.id,e=t.data.arg;if(n in P&&"function"==typeof P[n])try{const t=P[n](e);postMessage({id:r,method:n,success:!0,response:t})}catch(t){postMessage({id:r,method:n,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});']);return URL.createObjectURL(t)}function logInfo(t,r){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&(M.kg.info(t),r&&addBreadcrumb(t))}function logInfoNextTick(t,r){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&(M.kg.info(t),r&&setTimeout(()=>{addBreadcrumb(t)},0))}function addBreadcrumb(t){let r=(0,y.Gd)();r.addBreadcrumb({category:"console",data:{logger:"replay"},level:"info",message:t},{level:"info"})}let EventBufferSizeExceededError=class EventBufferSizeExceededError extends Error{constructor(){super("Event buffer exceeded maximum size of 20000000.")}};let EventBufferArray=class EventBufferArray{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(t){let r=JSON.stringify(t).length;if(this._totalSize+=r,this._totalSize>2e7)throw new EventBufferSizeExceededError;this.events.push(t)}finish(){return new Promise(t=>{let r=this.events;this.clear(),t(JSON.stringify(r))})}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){let t=this.events.map(t=>t.timestamp).sort()[0];return t?timestampToMs(t):null}};let WorkerHandler=class WorkerHandler{constructor(t){this._worker=t,this._id=0}ensureReady(){return this._ensureReadyPromise||(this._ensureReadyPromise=new Promise((t,r)=>{this._worker.addEventListener("message",({data:n})=>{n.success?t():r()},{once:!0}),this._worker.addEventListener("error",t=>{r(t)},{once:!0})})),this._ensureReadyPromise}destroy(){logInfo("[Replay] Destroying compression worker"),this._worker.terminate()}postMessage(t,r){let n=this._getAndIncrementId();return new Promise((i,s)=>{let listener=({data:r})=>{if(r.method===t&&r.id===n){if(this._worker.removeEventListener("message",listener),!r.success){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay]",r.response),s(Error("Error in compression worker"));return}i(r.response)}};this._worker.addEventListener("message",listener),this._worker.postMessage({id:n,method:t,arg:r})})}_getAndIncrementId(){return this._id++}};let EventBufferCompressionWorker=class EventBufferCompressionWorker{constructor(t){this._worker=new WorkerHandler(t),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(t){let r=timestampToMs(t.timestamp);(!this._earliestTimestamp||r<this._earliestTimestamp)&&(this._earliestTimestamp=r);let n=JSON.stringify(t);return(this._totalSize+=n.length,this._totalSize>2e7)?Promise.reject(new EventBufferSizeExceededError):this._sendEventToWorker(n)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear")}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(t){return this._worker.postMessage("addEvent",t)}async _finishRequest(){let t=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,t}};let EventBufferProxy=class EventBufferProxy{constructor(t){this._fallback=new EventBufferArray,this._compression=new EventBufferCompressionWorker(t),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(t){this._used.hasCheckout=t}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(t){return this._used.addEvent(t)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(t){logInfo("[Replay] Failed to load the compression worker, falling back to simple buffer");return}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){let{events:t,hasCheckout:r}=this._fallback,n=[];for(let r of t)n.push(this._compression.addEvent(r));this._compression.hasCheckout=r,this._used=this._compression;try{await Promise.all(n)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("[Replay] Failed to add events when switching buffers.",t)}}};function createEventBuffer({useCompression:t,workerUrl:r}){if(t&&window.Worker){let t=_loadWorker(r);if(t)return t}return logInfo("[Replay] Using simple buffer"),new EventBufferArray}function _loadWorker(t){try{let r=t||_getWorkerUrl();if(!r)return;logInfo(`[Replay] Using compression worker${t?` from ${t}`:""}`);let n=new Worker(r);return new EventBufferProxy(n)}catch(t){logInfo("[Replay] Failed to create compression worker")}}function _getWorkerUrl(){return"undefined"!=typeof __SENTRY_EXCLUDE_REPLAY_WORKER__&&__SENTRY_EXCLUDE_REPLAY_WORKER__?"":e()}function hasSessionStorage(){try{return"sessionStorage"in B&&!!B.sessionStorage}catch(t){return!1}}function clearSession(t){deleteSession(),t.session=void 0}function deleteSession(){if(hasSessionStorage())try{B.sessionStorage.removeItem(L)}catch(t){}}function isSampled(t){return void 0!==t&&Math.random()<t}function saveSession(t){if(hasSessionStorage())try{B.sessionStorage.setItem(L,JSON.stringify(t))}catch(t){}}function makeSession(t){let r=Date.now(),n=t.id||(0,T.DM)(),i=t.started||r,s=t.lastActivity||r,o=t.segmentId||0,a=t.sampled,l=t.previousSessionId;return{id:n,started:i,lastActivity:s,segmentId:o,sampled:a,previousSessionId:l}}function getSessionSampleType(t,r){return isSampled(t)?"session":!!r&&"buffer"}function createSession({sessionSampleRate:t,allowBuffering:r,stickySession:n=!1},{previousSessionId:i}={}){let s=getSessionSampleType(t,r),o=makeSession({sampled:s,previousSessionId:i});return n&&saveSession(o),o}function fetchSession(t){if(!hasSessionStorage())return null;try{let r=B.sessionStorage.getItem(L);if(!r)return null;let n=JSON.parse(r);return logInfoNextTick("[Replay] Loading existing session",t),makeSession(n)}catch(t){return null}}function isExpired(t,r,n=+new Date){return null===t||void 0===r||r<0||0!==r&&t+r<=n}function isSessionExpired(t,{maxReplayDuration:r,sessionIdleExpire:n,targetTime:i=Date.now()}){return isExpired(t.started,r,i)||isExpired(t.lastActivity,n,i)}function shouldRefreshSession(t,{sessionIdleExpire:r,maxReplayDuration:n}){return!!isSessionExpired(t,{sessionIdleExpire:r,maxReplayDuration:n})&&("buffer"!==t.sampled||0!==t.segmentId)}function loadOrCreateSession({traceInternals:t,sessionIdleExpire:r,maxReplayDuration:n,previousSessionId:i},s){let o=s.stickySession&&fetchSession(t);return o?shouldRefreshSession(o,{sessionIdleExpire:r,maxReplayDuration:n})?(logInfoNextTick("[Replay] Session in sessionStorage is expired, creating new one..."),createSession(s,{previousSessionId:o.id})):o:(logInfoNextTick("[Replay] Creating new session",t),createSession(s,{previousSessionId:i}))}function isCustomEvent(t){return t.type===X.Custom}function addEventSync(t,r,n){return!!shouldAddEvent(t,r)&&(_addEvent(t,r,n),!0)}function addEvent(t,r,n){return shouldAddEvent(t,r)?_addEvent(t,r,n):Promise.resolve(null)}async function _addEvent(t,r,n){if(!t.eventBuffer)return null;try{n&&"buffer"===t.recordingMode&&t.eventBuffer.clear(),n&&(t.eventBuffer.hasCheckout=!0);let i=t.getOptions(),s=maybeApplyCallback(r,i.beforeAddRecordingEvent);if(!s)return;return await t.eventBuffer.addEvent(s)}catch(i){let r=i&&i instanceof EventBufferSizeExceededError?"addEventSizeExceeded":"addEvent";("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error(i),await t.stop({reason:r});let n=(0,y.Gd)().getClient();n&&n.recordDroppedEvent("internal_sdk_error","replay")}}function shouldAddEvent(t,r){if(!t.eventBuffer||t.isPaused()||!t.isEnabled())return!1;let n=timestampToMs(r.timestamp);return!(n+t.timeouts.sessionIdlePause<Date.now())&&(!(n>t.getContext().initialTimestamp+t.getOptions().maxReplayDuration)||(logInfo(`[Replay] Skipping event with timestamp ${n} because it is after maxReplayDuration`,t.getOptions()._experiments.traceInternals),!1))}function maybeApplyCallback(t,r){try{if("function"==typeof r&&isCustomEvent(t))return r(t)}catch(t){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] An error occured in the `beforeAddRecordingEvent` callback, skipping the event...",t),null}return t}function isTransactionEvent(t){return"transaction"===t.type}function isReplayEvent(t){return"replay_event"===t.type}function isFeedbackEvent(t){return"feedback"===t.type}function handleAfterSendEvent(t){let r=isBaseTransportSend();return(n,i)=>{if(!t.isEnabled()||n.type&&!isTransactionEvent(n))return;let s=i&&i.statusCode;if(!r||s&&!(s<200)&&!(s>=300)){if(isTransactionEvent(n)){handleTransactionEvent(t,n);return}handleErrorEvent(t,n)}}}function handleTransactionEvent(t,r){let n=t.getContext();r.contexts&&r.contexts.trace&&r.contexts.trace.trace_id&&n.traceIds.size<100&&n.traceIds.add(r.contexts.trace.trace_id)}function handleErrorEvent(t,r){let n=t.getContext();if(r.event_id&&n.errorIds.size<100&&n.errorIds.add(r.event_id),"buffer"!==t.recordingMode||!r.tags||!r.tags.replayId)return;let{beforeErrorSampling:i}=t.getOptions();("function"!=typeof i||i(r))&&setTimeout(()=>{t.sendBufferedReplayOrFlush()})}function isBaseTransportSend(){let t=(0,y.Gd)().getClient();if(!t)return!1;let r=t.getTransport();return!!r&&(r.send.__sentry__baseTransport__||!1)}function isRrwebError(t,r){return!t.type&&!!t.exception&&!!t.exception.values&&!!t.exception.values.length&&!!r.originalException&&!!r.originalException.__rrweb__}function addFeedbackBreadcrumb(t,r){t.triggerUserActivity(),t.addUpdate(()=>!r.timestamp||(t.throttledAddEvent({type:X.Custom,timestamp:1e3*r.timestamp,data:{timestamp:r.timestamp,tag:"breadcrumb",payload:{category:"sentry.feedback",data:{feedbackId:r.event_id}}}}),!1))}function shouldSampleForBufferEvent(t,r){return"buffer"===t.recordingMode&&r.message!==P&&!!r.exception&&!r.type&&isSampled(t.getOptions().errorSampleRate)}function handleGlobalEventListener(t,r=!1){let n=r?handleAfterSendEvent(t):void 0;return Object.assign((r,i)=>{if(!t.isEnabled())return r;if(isReplayEvent(r))return delete r.breadcrumbs,r;if(r.type&&!isTransactionEvent(r)&&!isFeedbackEvent(r))return r;let s=t.checkAndHandleExpiredSession();if(!s)return r;if(isFeedbackEvent(r))return t.flush(),r.contexts.feedback.replay_id=t.getSessionId(),addFeedbackBreadcrumb(t,r),r;if(isRrwebError(r,i)&&!t.getOptions()._experiments.captureExceptions)return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.log("[Replay] Ignoring error from rrweb internals",r),null;let o=shouldSampleForBufferEvent(t,r),a=o||"session"===t.recordingMode;return a&&(r.tags={...r.tags,replayId:t.getSessionId()}),n&&n(r,{statusCode:200}),r},{id:"Replay"})}function createPerformanceSpans(t,r){return r.map(({type:r,start:n,end:i,name:s,data:o})=>{let a=t.throttledAddEvent({type:X.Custom,timestamp:n,data:{tag:"performanceSpan",payload:{op:r,description:s,startTimestamp:n,endTimestamp:i,data:o}}});return"string"==typeof a?Promise.resolve(null):a})}function handleHistory(t){let{from:r,to:n}=t,i=Date.now()/1e3;return{type:"navigation.push",start:i,end:i,name:n,data:{previous:r}}}function handleHistorySpanListener(t){return r=>{if(!t.isEnabled())return;let n=handleHistory(r);null!==n&&(t.getContext().urls.push(n.name),t.triggerUserActivity(),t.addUpdate(()=>(createPerformanceSpans(t,[n]),!1)))}}function shouldFilterRequest(t,r){return(!("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)||!t.getOptions()._experiments.traceInternals)&&(0,S.W)(r,(0,y.Gd)())}function addNetworkBreadcrumb(t,r){!t.isEnabled()||null===r||shouldFilterRequest(t,r.name)||t.addUpdate(()=>(createPerformanceSpans(t,[r]),!0))}function handleFetch(t){let{startTimestamp:r,endTimestamp:n,fetchData:i,response:s}=t;if(!n)return null;let{method:o,url:a}=i;return{type:"resource.fetch",start:r/1e3,end:n/1e3,name:a,data:{method:o,statusCode:s?s.status:void 0}}}function handleFetchSpanListener(t){return r=>{if(!t.isEnabled())return;let n=handleFetch(r);addNetworkBreadcrumb(t,n)}}function handleXhr(t){let{startTimestamp:r,endTimestamp:n,xhr:i}=t,s=i[C.xU];if(!r||!n||!s)return null;let{method:o,url:a,status_code:l}=s;return void 0===a?null:{type:"resource.xhr",name:a,start:r/1e3,end:n/1e3,data:{method:o,statusCode:l}}}function handleXhrSpanListener(t){return r=>{if(!t.isEnabled())return;let n=handleXhr(r);addNetworkBreadcrumb(t,n)}}function getBodySize(t,r){if(t)try{if("string"==typeof t)return r.encode(t).length;if(t instanceof URLSearchParams)return r.encode(t.toString()).length;if(t instanceof FormData){let n=_serializeFormData(t);return r.encode(n).length}if(t instanceof Blob)return t.size;if(t instanceof ArrayBuffer)return t.byteLength}catch(t){}}function parseContentLengthHeader(t){if(!t)return;let r=parseInt(t,10);return isNaN(r)?void 0:r}function getBodyString(t){try{if("string"==typeof t)return t;if(t instanceof URLSearchParams)return t.toString();if(t instanceof FormData)return _serializeFormData(t)}catch(r){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("[Replay] Failed to serialize body",t)}("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.info("[Replay] Skipping network body because of body type",t)}function makeNetworkReplayBreadcrumb(t,r){if(!r)return null;let{startTimestamp:n,endTimestamp:i,url:s,method:o,statusCode:a,request:l,response:d}=r,c={type:t,start:n/1e3,end:i/1e3,name:s,data:(0,k.Jr)({method:o,statusCode:a,request:l,response:d})};return c}function buildSkippedNetworkRequestOrResponse(t){return{headers:{},size:t,_meta:{warnings:["URL_SKIPPED"]}}}function buildNetworkRequestOrResponse(t,r,n){if(!r&&0===Object.keys(t).length)return;if(!r)return{headers:t};if(!n)return{headers:t,size:r};let i={headers:t,size:r},{body:s,warnings:o}=normalizeNetworkBody(n);return i.body=s,o&&o.length>0&&(i._meta={warnings:o}),i}function getAllowedHeaders(t,r){return Object.keys(t).reduce((n,i)=>{let s=i.toLowerCase();return r.includes(s)&&t[i]&&(n[s]=t[i]),n},{})}function _serializeFormData(t){return new URLSearchParams(t).toString()}function normalizeNetworkBody(t){if(!t||"string"!=typeof t)return{body:t};let r=t.length>15e4,n=_strIsProbablyJson(t);if(r){let r=t.slice(0,15e4);return n?{body:r,warnings:["MAYBE_JSON_TRUNCATED"]}:{body:`${r}`,warnings:["TEXT_TRUNCATED"]}}if(n)try{let r=JSON.parse(t);return{body:r}}catch(t){}return{body:t}}function _strIsProbablyJson(t){let r=t[0],n=t[t.length-1];return"["===r&&"]"===n||"{"===r&&"}"===n}function urlMatches(t,r){let n=getFullUrl(t);return(0,x.U0)(n,r)}function getFullUrl(t,r=B.document.baseURI){if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith(B.location.origin))return t;let n=new URL(t,r);if(n.origin!==new URL(r).origin)return t;let i=n.href;return!t.endsWith("/")&&i.endsWith("/")?i.slice(0,-1):i}async function captureFetchBreadcrumbToReplay(t,r,n){try{let i=await _prepareFetchData(t,r,n),s=makeNetworkReplayBreadcrumb("resource.fetch",i);addNetworkBreadcrumb(n.replay,s)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] Failed to capture fetch breadcrumb",t)}}function enrichFetchBreadcrumb(t,r,n){let{input:i,response:s}=r,o=i?_getFetchRequestArgBody(i):void 0,a=getBodySize(o,n.textEncoder),l=s?parseContentLengthHeader(s.headers.get("content-length")):void 0;void 0!==a&&(t.data.request_body_size=a),void 0!==l&&(t.data.response_body_size=l)}async function _prepareFetchData(t,r,n){let i=Date.now(),{startTimestamp:s=i,endTimestamp:o=i}=r,{url:a,method:l,status_code:d=0,request_body_size:c,response_body_size:u}=t.data,h=urlMatches(a,n.networkDetailAllowUrls)&&!urlMatches(a,n.networkDetailDenyUrls),p=h?_getRequestInfo(n,r.input,c):buildSkippedNetworkRequestOrResponse(c),m=await _getResponseInfo(h,n,r.response,u);return{startTimestamp:s,endTimestamp:o,url:a,method:l,statusCode:d,request:p,response:m}}function _getRequestInfo({networkCaptureBodies:t,networkRequestHeaders:r},n,i){let s=n?getRequestHeaders(n,r):{};if(!t)return buildNetworkRequestOrResponse(s,i,void 0);let o=_getFetchRequestArgBody(n),a=getBodyString(o);return buildNetworkRequestOrResponse(s,i,a)}async function _getResponseInfo(t,{networkCaptureBodies:r,textEncoder:n,networkResponseHeaders:i},s,o){if(!t&&void 0!==o)return buildSkippedNetworkRequestOrResponse(o);let a=s?getAllHeaders(s.headers,i):{};if(!s||!r&&void 0!==o)return buildNetworkRequestOrResponse(a,o,void 0);try{let i=s.clone(),l=await _parseFetchBody(i),d=l&&l.length&&void 0===o?getBodySize(l,n):o;if(!t)return buildSkippedNetworkRequestOrResponse(d);if(r)return buildNetworkRequestOrResponse(a,d,l);return buildNetworkRequestOrResponse(a,d,void 0)}catch(t){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("[Replay] Failed to serialize response body",t),buildNetworkRequestOrResponse(a,o,void 0)}}async function _parseFetchBody(t){try{return await t.text()}catch(t){return}}function _getFetchRequestArgBody(t=[]){if(2===t.length&&"object"==typeof t[1])return t[1].body}function getAllHeaders(t,r){let n={};return r.forEach(r=>{t.get(r)&&(n[r]=t.get(r))}),n}function getRequestHeaders(t,r){return 1===t.length&&"string"!=typeof t[0]?getHeadersFromOptions(t[0],r):2===t.length?getHeadersFromOptions(t[1],r):{}}function getHeadersFromOptions(t,r){if(!t)return{};let n=t.headers;return n?n instanceof Headers?getAllHeaders(n,r):Array.isArray(n)?{}:getAllowedHeaders(n,r):{}}async function captureXhrBreadcrumbToReplay(t,r,n){try{let i=_prepareXhrData(t,r,n),s=makeNetworkReplayBreadcrumb("resource.xhr",i);addNetworkBreadcrumb(n.replay,s)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] Failed to capture xhr breadcrumb",t)}}function enrichXhrBreadcrumb(t,r,n){let{xhr:i,input:s}=r;if(!i)return;let o=getBodySize(s,n.textEncoder),a=i.getResponseHeader("content-length")?parseContentLengthHeader(i.getResponseHeader("content-length")):getBodySize(i.response,n.textEncoder);void 0!==o&&(t.data.request_body_size=o),void 0!==a&&(t.data.response_body_size=a)}function _prepareXhrData(t,r,n){let i=Date.now(),{startTimestamp:s=i,endTimestamp:o=i,input:a,xhr:l}=r,{url:d,method:c,status_code:u=0,request_body_size:h,response_body_size:p}=t.data;if(!d)return null;if(!l||!urlMatches(d,n.networkDetailAllowUrls)||urlMatches(d,n.networkDetailDenyUrls)){let t=buildSkippedNetworkRequestOrResponse(h),r=buildSkippedNetworkRequestOrResponse(p);return{startTimestamp:s,endTimestamp:o,url:d,method:c,statusCode:u,request:t,response:r}}let m=l[C.xU],f=m?getAllowedHeaders(m.request_headers,n.networkRequestHeaders):{},g=getAllowedHeaders(getResponseHeaders(l),n.networkResponseHeaders),y=n.networkCaptureBodies?getBodyString(a):void 0,S=n.networkCaptureBodies?_getXhrResponseBody(l):void 0,_=buildNetworkRequestOrResponse(f,h,y),v=buildNetworkRequestOrResponse(g,p,S);return{startTimestamp:s,endTimestamp:o,url:d,method:c,statusCode:u,request:_,response:v}}function getResponseHeaders(t){let r=t.getAllResponseHeaders();return r?r.split("\r\n").reduce((t,r)=>{let[n,i]=r.split(": ");return t[n.toLowerCase()]=i,t},{}):{}}function _getXhrResponseBody(t){let r=[];try{return t.responseText}catch(t){r.push(t)}try{let r=t.response;return getBodyString(r)}catch(t){r.push(t)}("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("[Replay] Failed to get xhr response body",...r)}function handleNetworkBreadcrumbs(t){let r=(0,y.Gd)().getClient();try{let n=new TextEncoder,{networkDetailAllowUrls:i,networkDetailDenyUrls:s,networkCaptureBodies:o,networkRequestHeaders:a,networkResponseHeaders:l}=t.getOptions(),d={replay:t,textEncoder:n,networkDetailAllowUrls:i,networkDetailDenyUrls:s,networkCaptureBodies:o,networkRequestHeaders:a,networkResponseHeaders:l};r&&r.on?r.on("beforeAddBreadcrumb",(t,r)=>beforeAddNetworkBreadcrumb(d,t,r)):((0,C.oq)("fetch",handleFetchSpanListener(t)),(0,C.oq)("xhr",handleXhrSpanListener(t)))}catch(t){}}function beforeAddNetworkBreadcrumb(t,r,n){if(r.data)try{_isXhrBreadcrumb(r)&&_isXhrHint(n)&&(enrichXhrBreadcrumb(r,n,t),captureXhrBreadcrumbToReplay(r,n,t)),_isFetchBreadcrumb(r)&&_isFetchHint(n)&&(enrichFetchBreadcrumb(r,n,t),captureFetchBreadcrumbToReplay(r,n,t))}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("Error when enriching network breadcrumb")}}function _isXhrBreadcrumb(t){return"xhr"===t.category}function _isFetchBreadcrumb(t){return"fetch"===t.category}function _isXhrHint(t){return t&&t.xhr}function _isFetchHint(t){return t&&t.response}let ea=null;function isBreadcrumbWithCategory(t){return!!t.category}let handleScopeListener=t=>r=>{if(!t.isEnabled())return;let n=handleScope(r);n&&addBreadcrumbEvent(t,n)};function handleScope(t){let r=t.getLastBreadcrumb&&t.getLastBreadcrumb();return ea!==r&&r?(ea=r,!isBreadcrumbWithCategory(r)||["fetch","xhr","sentry.event","sentry.transaction"].includes(r.category)||r.category.startsWith("ui."))?null:"console"===r.category?normalizeConsoleBreadcrumb(r):createBreadcrumb(r):null}function normalizeConsoleBreadcrumb(t){let r=t.data&&t.data.arguments;if(!Array.isArray(r)||0===r.length)return createBreadcrumb(t);let n=!1,i=r.map(t=>{if(!t)return t;if("string"==typeof t)return t.length>5e3?(n=!0,`${t.slice(0,5e3)}`):t;if("object"==typeof t)try{let r=(0,w.Fv)(t,7),i=JSON.stringify(r);if(i.length>5e3)return n=!0,`${JSON.stringify(r,null,2).slice(0,5e3)}`;return r}catch(t){}return t});return createBreadcrumb({...t,data:{...t.data,arguments:i,...n?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}function addGlobalListeners(t){let r=(0,y.Gd)().getScope(),n=(0,y.Gd)().getClient();r.addScopeListener(handleScopeListener(t)),(0,C.oq)("dom",handleDomListener(t)),(0,C.oq)("history",handleHistorySpanListener(t)),handleNetworkBreadcrumbs(t);let i=handleGlobalEventListener(t,!(n&&n.on));n&&n.addEventProcessor?n.addEventProcessor(i):(0,_.cc)(i),n&&n.on&&(n.on("afterSendEvent",handleAfterSendEvent(t)),n.on("createDsc",r=>{let n=t.getSessionId();if(n&&t.isEnabled()&&"session"===t.recordingMode){let i=t.checkAndHandleExpiredSession();i&&(r.replay_id=n)}}),n.on("startTransaction",r=>{t.lastTransaction=r}),n.on("finishTransaction",r=>{t.lastTransaction=r}),n.on("beforeSendFeedback",(r,n)=>{let i=t.getSessionId();n&&n.includeReplay&&t.isEnabled()&&i&&(t.flush(),r.contexts&&r.contexts.feedback&&(r.contexts.feedback.replay_id=i))}))}async function addMemoryEntry(t){try{return Promise.all(createPerformanceSpans(t,[createMemoryEntry(B.performance.memory)]))}catch(t){return[]}}function createMemoryEntry(t){let{jsHeapSizeLimit:r,totalJSHeapSize:n,usedJSHeapSize:i}=t,s=Date.now()/1e3;return{type:"memory",name:"memory",start:s,end:s,data:{memory:{jsHeapSizeLimit:r,totalJSHeapSize:n,usedJSHeapSize:i}}}}function debounce(t,r,n){let i,s,o;let a=n&&n.maxWait?Math.max(n.maxWait,r):0;function invokeFunc(){return cancelTimers(),i=t()}function cancelTimers(){void 0!==s&&clearTimeout(s),void 0!==o&&clearTimeout(o),s=o=void 0}function flush(){return void 0!==s||void 0!==o?invokeFunc():i}function debounced(){return s&&clearTimeout(s),s=setTimeout(invokeFunc,r),a&&void 0===o&&(o=setTimeout(invokeFunc,a)),i}return debounced.cancel=cancelTimers,debounced.flush=flush,debounced}function getHandleRecordingEmit(t){let r=!1;return(n,i)=>{if(!t.checkAndHandleExpiredSession()){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("[Replay] Received replay event after session expired.");return}let s=i||!r;r=!0,t.clickDetector&&updateClickDetectorForRecordingEvent(t.clickDetector,n),t.addUpdate(()=>{if("buffer"===t.recordingMode&&s&&t.setInitialState(),!addEventSync(t,n,s))return!0;if(!s)return!1;if(addSettingsEvent(t,s),t.session&&t.session.previousSessionId)return!0;if("buffer"===t.recordingMode&&t.session&&t.eventBuffer){let r=t.eventBuffer.getEarliestTimestamp();r&&(logInfo(`[Replay] Updating session start time to earliest event in buffer to ${new Date(r)}`,t.getOptions()._experiments.traceInternals),t.session.started=r,t.getOptions().stickySession&&saveSession(t.session))}return"session"===t.recordingMode&&t.flush(),!0})}}function createOptionsEvent(t){let r=t.getOptions();return{type:X.Custom,timestamp:Date.now(),data:{tag:"options",payload:{sessionSampleRate:r.sessionSampleRate,errorSampleRate:r.errorSampleRate,useCompressionOption:r.useCompression,blockAllMedia:r.blockAllMedia,maskAllText:r.maskAllText,maskAllInputs:r.maskAllInputs,useCompression:!!t.eventBuffer&&"worker"===t.eventBuffer.type,networkDetailHasUrls:r.networkDetailAllowUrls.length>0,networkCaptureBodies:r.networkCaptureBodies,networkRequestHasHeaders:r.networkRequestHeaders.length>0,networkResponseHasHeaders:r.networkResponseHeaders.length>0}}}}function addSettingsEvent(t,r){r&&t.session&&0===t.session.segmentId&&addEventSync(t,createOptionsEvent(t),!1)}function createReplayEnvelope(t,r,n,i){return(0,N.Jd)((0,N.Cd)(t,(0,N.HY)(t),i,n),[[{type:"replay_event"},t],[{type:"replay_recording",length:"string"==typeof r?new TextEncoder().encode(r).length:r.length},r]])}function prepareRecordingData({recordingData:t,headers:r}){let n;let i=`${JSON.stringify(r)}
`;if("string"==typeof t)n=`${i}${t}`;else{let r=new TextEncoder,s=r.encode(i);(n=new Uint8Array(s.length+t.length)).set(s),n.set(t,s.length)}return n}async function prepareReplayEvent({client:t,scope:r,replayId:n,event:i}){let s="object"!=typeof t._integrations||null===t._integrations||Array.isArray(t._integrations)?void 0:Object.keys(t._integrations),o={event_id:n,integrations:s};t.emit&&t.emit("preprocessEvent",i,o);let a=await (0,v.R)(t.getOptions(),i,o,r,t);if(!a)return null;a.platform=a.platform||"javascript";let l=t.getSdkMetadata&&t.getSdkMetadata(),{name:d,version:c}=l&&l.sdk||{};return a.sdk={...a.sdk,name:d||"sentry.javascript.unknown",version:c||"0.0.0"},a}async function sendReplayRequest({recordingData:t,replayId:r,segmentId:n,eventContext:i,timestamp:s,session:o}){let a;let l=prepareRecordingData({recordingData:t,headers:{segment_id:n}}),{urls:d,errorIds:c,traceIds:u,initialTimestamp:h}=i,p=(0,y.Gd)(),m=p.getClient(),f=p.getScope(),g=m&&m.getTransport(),S=m&&m.getDsn();if(!m||!g||!S||!o.sampled)return;let _={type:"replay_event",replay_start_timestamp:h/1e3,timestamp:s/1e3,error_ids:c,trace_ids:u,urls:d,replay_id:r,segment_id:n,replay_type:o.sampled},v=await prepareReplayEvent({scope:f,client:m,replayId:r,event:_});if(!v){m.recordDroppedEvent("event_processor","replay",_),logInfo("An event processor returned `null`, will not send event.");return}delete v.sdkProcessingMetadata;let b=createReplayEnvelope(v,l,S,m.getOptions().tunnel);try{a=await g.send(b)}catch(r){let t=Error(P);try{t.cause=r}catch(t){}throw t}if(!a)return a;if("number"==typeof a.statusCode&&(a.statusCode<200||a.statusCode>=300))throw new TransportStatusCodeError(a.statusCode);let E=(0,D.WG)({},a);if((0,D.Q)(E,"replay"))throw new RateLimitError(E);return a}let TransportStatusCodeError=class TransportStatusCodeError extends Error{constructor(t){super(`Transport returned status code ${t}`)}};let RateLimitError=class RateLimitError extends Error{constructor(t){super("Rate limit hit"),this.rateLimits=t}};async function sendReplay(t,r={count:0,interval:5e3}){let{recordingData:n,options:i}=t;if(n.length)try{return await sendReplayRequest(t),!0}catch(n){if(n instanceof TransportStatusCodeError||n instanceof RateLimitError)throw n;if((0,b.v)("Replays",{_retryCount:r.count}),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&i._experiments&&i._experiments.captureExceptions&&(0,b.Tb)(n),r.count>=3){let t=Error(`${P} - max retries exceeded`);try{t.cause=n}catch(t){}throw t}return r.interval*=++r.count,new Promise((n,i)=>{setTimeout(async()=>{try{await sendReplay(t,r),n(!0)}catch(t){i(t)}},r.interval)})}}let el="__THROTTLED";function throttle(t,r,n){let i=new Map,_cleanup=t=>{let r=t-n;i.forEach((t,n)=>{n<r&&i.delete(n)})},_getTotalCount=()=>[...i.values()].reduce((t,r)=>t+r,0),s=!1;return(...n)=>{let o=Math.floor(Date.now()/1e3);if(_cleanup(o),_getTotalCount()>=r){let t=s;return s=!0,t?"__SKIPPED":el}s=!1;let a=i.get(o)||0;return i.set(o,a+1),t(...n)}}let ReplayContainer=class ReplayContainer{constructor({options:t,recordingOptions:r}){ReplayContainer.prototype.__init.call(this),ReplayContainer.prototype.__init2.call(this),ReplayContainer.prototype.__init3.call(this),ReplayContainer.prototype.__init4.call(this),ReplayContainer.prototype.__init5.call(this),ReplayContainer.prototype.__init6.call(this),this.eventBuffer=null,this.performanceEntries=[],this.replayPerformanceEntries=[],this.recordingMode="session",this.timeouts={sessionIdlePause:3e5,sessionIdleExpire:9e5},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=r,this._options=t,this._debouncedFlush=debounce(()=>this._flush(),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=throttle((t,r)=>addEvent(this,t,r),300,5);let{slowClickTimeout:n,slowClickIgnoreSelectors:i}=this.getOptions(),s=n?{threshold:Math.min(3e3,n),timeout:n,scrollTimeout:300,ignoreSelector:i?i.join(","):""}:void 0;s&&(this.clickDetector=new ClickDetector(this,s))}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}getOptions(){return this._options}initializeSampling(t){let{errorSampleRate:r,sessionSampleRate:n}=this._options;if(!(r<=0)||!(n<=0)){if(this._initializeSessionForSampling(t),!this.session){this._handleException(Error("Unable to initialize and create session"));return}!1!==this.session.sampled&&(this.recordingMode="buffer"===this.session.sampled&&0===this.session.segmentId?"buffer":"session",logInfoNextTick(`[Replay] Starting replay in ${this.recordingMode} mode`,this._options._experiments.traceInternals),this._initializeRecording())}}start(){if(this._isEnabled&&"session"===this.recordingMode)throw Error("Replay recording is already in progress");if(this._isEnabled&&"buffer"===this.recordingMode)throw Error("Replay buffering is in progress, call `flush()` to save the replay");logInfoNextTick("[Replay] Starting replay in session mode",this._options._experiments.traceInternals);let t=loadOrCreateSession({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=t,this._initializeRecording()}startBuffering(){if(this._isEnabled)throw Error("Replay recording is already in progress");logInfoNextTick("[Replay] Starting replay in buffer mode",this._options._experiments.traceInternals);let t=loadOrCreateSession({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=t,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{this._stopRecording=record({...this._recordingOptions,..."buffer"===this.recordingMode&&{checkoutEveryNms:6e4},emit:getHandleRecordingEmit(this),onMutation:this._onMutationHandler})}catch(t){this._handleException(t)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(t){return this._handleException(t),!1}}async stop({forceFlush:t=!1,reason:r}={}){if(this._isEnabled){this._isEnabled=!1;try{logInfo(`[Replay] Stopping Replay${r?` triggered by ${r}`:""}`,this._options._experiments.traceInternals),this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),t&&await this._flush({force:!0}),this.eventBuffer&&this.eventBuffer.destroy(),this.eventBuffer=null,clearSession(this)}catch(t){this._handleException(t)}}}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),logInfo("[Replay] Pausing replay",this._options._experiments.traceInternals))}resume(){this._isPaused&&this._checkSession()&&(this._isPaused=!1,this.startRecording(),logInfo("[Replay] Resuming replay",this._options._experiments.traceInternals))}async sendBufferedReplayOrFlush({continueRecording:t=!0}={}){if("session"===this.recordingMode)return this.flushImmediate();let r=Date.now();logInfo("[Replay] Converting buffer to session",this._options._experiments.traceInternals),await this.flushImmediate();let n=this.stopRecording();t&&n&&"session"!==this.recordingMode&&(this.recordingMode="session",this.session&&(this._updateUserActivity(r),this._updateSessionActivity(r),this._maybeSaveSession()),this.startRecording())}addUpdate(t){let r=t();"buffer"!==this.recordingMode&&!0!==r&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),!this._stopRecording){if(!this._checkSession())return;this.resume();return}this.checkAndHandleExpiredSession(),this._updateSessionActivity()}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return"buffer"===this.recordingMode?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){if(this._lastActivity&&isExpired(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&"session"===this.session.sampled){this.pause();return}return!!this._checkSession()}setInitialState(){let t=`${B.location.pathname}${B.location.hash}${B.location.search}`,r=`${B.location.origin}${t}`;this.performanceEntries=[],this.replayPerformanceEntries=[],this._clearContext(),this._context.initialUrl=r,this._context.initialTimestamp=Date.now(),this._context.urls.push(r)}throttledAddEvent(t,r){let n=this._throttledAddEvent(t,r);if(n===el){let t=createBreadcrumb({category:"replay.throttled"});this.addUpdate(()=>!addEventSync(this,{type:5,timestamp:t.timestamp||0,data:{tag:"breadcrumb",payload:t,metric:!0}}))}return n}getCurrentRoute(){let t=this.lastTransaction||(0,y.Gd)().getScope().getTransaction();if(t&&["route","custom"].includes(t.metadata.source))return t.name}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=createEventBuffer({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_handleException(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay]",t),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&this._options._experiments&&this._options._experiments.captureExceptions&&(0,b.Tb)(t)}_initializeSessionForSampling(t){let r=this._options.errorSampleRate>0,n=loadOrCreateSession({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals,previousSessionId:t},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:r});this.session=n}_checkSession(){if(!this.session)return!1;let t=this.session;return!shouldRefreshSession(t,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})||(this._refreshSession(t),!1)}async _refreshSession(t){this._isEnabled&&(await this.stop({reason:"refresh session"}),this.initializeSampling(t.id))}_addListeners(){try{B.document.addEventListener("visibilitychange",this._handleVisibilityChange),B.addEventListener("blur",this._handleWindowBlur),B.addEventListener("focus",this._handleWindowFocus),B.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(addGlobalListeners(this),this._hasInitializedCoreListeners=!0)}catch(t){this._handleException(t)}this._performanceCleanupCallback=setupPerformanceObserver(this)}_removeListeners(){try{B.document.removeEventListener("visibilitychange",this._handleVisibilityChange),B.removeEventListener("blur",this._handleWindowBlur),B.removeEventListener("focus",this._handleWindowFocus),B.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(t){this._handleException(t)}}__init(){this._handleVisibilityChange=()=>{"visible"===B.document.visibilityState?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init2(){this._handleWindowBlur=()=>{let t=createBreadcrumb({category:"ui.blur"});this._doChangeToBackgroundTasks(t)}}__init3(){this._handleWindowFocus=()=>{let t=createBreadcrumb({category:"ui.focus"});this._doChangeToForegroundTasks(t)}}__init4(){this._handleKeyboardEvent=t=>{handleKeyboardEvent(this,t)}}_doChangeToBackgroundTasks(t){if(!this.session)return;let r=isSessionExpired(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire});r||(t&&this._createCustomBreadcrumb(t),this.conditionalFlush())}_doChangeToForegroundTasks(t){if(!this.session)return;let r=this.checkAndHandleExpiredSession();if(!r){logInfo("[Replay] Document has become active, but session has expired");return}t&&this._createCustomBreadcrumb(t)}_updateUserActivity(t=Date.now()){this._lastActivity=t}_updateSessionActivity(t=Date.now()){this.session&&(this.session.lastActivity=t,this._maybeSaveSession())}_createCustomBreadcrumb(t){this.addUpdate(()=>{this.throttledAddEvent({type:X.Custom,timestamp:t.timestamp||0,data:{tag:"breadcrumb",payload:t}})})}_addPerformanceEntries(){let t=createPerformanceEntries(this.performanceEntries).concat(this.replayPerformanceEntries);return this.performanceEntries=[],this.replayPerformanceEntries=[],Promise.all(createPerformanceSpans(this,t))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){let{session:t,eventBuffer:r}=this;if(!t||!r||t.segmentId)return;let n=r.getEarliestTimestamp();n&&n<this._context.initialTimestamp&&(this._context.initialTimestamp=n)}_popEventContext(){let t={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),t}async _runFlush(){let t=this.getSessionId();if(!this.session||!this.eventBuffer||!t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] No session or eventBuffer found to flush.");return}if(await this._addPerformanceEntries(),this.eventBuffer&&this.eventBuffer.hasEvents&&(await addMemoryEntry(this),this.eventBuffer&&t===this.getSessionId()))try{this._updateInitialTimestampFromEventBuffer();let r=Date.now();if(r-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw Error("Session is too long, not sending replay");let n=this._popEventContext(),i=this.session.segmentId++;this._maybeSaveSession();let s=await this.eventBuffer.finish();await sendReplay({replayId:t,recordingData:s,segmentId:i,eventContext:n,session:this.session,options:this.getOptions(),timestamp:r})}catch(r){this._handleException(r),this.stop({reason:"sendReplay"});let t=(0,y.Gd)().getClient();t&&t.recordDroppedEvent("send_error","replay")}}__init5(){this._flush=async({force:t=!1}={})=>{if(!this._isEnabled&&!t)return;if(!this.checkAndHandleExpiredSession()){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] Attempting to finish replay event after session expired.");return}if(!this.session)return;let r=this.session.started,n=Date.now(),i=n-r;this._debouncedFlush.cancel();let s=i<this._options.minReplayDuration,o=i>this._options.maxReplayDuration+5e3;if(s||o){logInfo(`[Replay] Session duration (${Math.floor(i/1e3)}s) is too ${s?"short":"long"}, not sending replay.`,this._options._experiments.traceInternals),s&&this._debouncedFlush();return}let a=this.eventBuffer;if(a&&0===this.session.segmentId&&!a.hasCheckout&&logInfo("[Replay] Flushing initial segment without checkout.",this._options._experiments.traceInternals),!this._flushLock){this._flushLock=this._runFlush(),await this._flushLock,this._flushLock=void 0;return}try{await this._flushLock}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error(t)}finally{this._debouncedFlush()}}}_maybeSaveSession(){this.session&&this._options.stickySession&&saveSession(this.session)}__init6(){this._onMutationHandler=t=>{let r=t.length,n=this._options.mutationLimit,i=this._options.mutationBreadcrumbLimit,s=n&&r>n;if(r>i||s){let t=createBreadcrumb({category:"replay.mutations",data:{count:r,limit:s}});this._createCustomBreadcrumb(t)}return!s||(this.stop({reason:"mutationLimit",forceFlush:"session"===this.recordingMode}),!1)}}};function getOption(t,r,n,i){let s="string"==typeof i?i.split(","):[],o=[...t,...s,...r];return void 0!==n&&("string"==typeof n&&o.push(`.${n}`),console.warn("[Replay] You are using a deprecated configuration item for privacy. Read the documentation on how to use the new privacy configuration.")),o.join(",")}function getPrivacyOptions({mask:t,unmask:r,block:n,unblock:i,ignore:s,blockClass:o,blockSelector:a,maskTextClass:l,maskTextSelector:d,ignoreClass:c}){let u=getOption(t,[".sentry-mask","[data-sentry-mask]"],l,d),h=getOption(r,[".sentry-unmask","[data-sentry-unmask]"]),p={maskTextSelector:u,unmaskTextSelector:h,blockSelector:getOption(n,[".sentry-block","[data-sentry-block]",'base[href="/"]'],o,a),unblockSelector:getOption(i,[".sentry-unblock","[data-sentry-unblock]"]),ignoreSelector:getOption(s,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'],c)};return o instanceof RegExp&&(p.blockClass=o),l instanceof RegExp&&(p.maskTextClass=l),p}function maskAttribute({el:t,key:r,maskAttributes:n,maskAllText:i,privacyOptions:s,value:o}){return!i||s.unmaskTextSelector&&t.matches(s.unmaskTextSelector)?o:n.includes(r)||"value"===r&&"INPUT"===t.tagName&&["submit","button"].includes(t.getAttribute("type")||"")?o.replace(/[\S]/g,"*"):o}let ed='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',ec=["content-length","content-type","accept"],eu=!1;let Replay=class Replay{static __initStatic(){this.id="Replay"}constructor({flushMinDelay:t=5e3,flushMaxDelay:r=5500,minReplayDuration:n=4999,maxReplayDuration:i=36e5,stickySession:s=!0,useCompression:o=!0,workerUrl:a,_experiments:l={},sessionSampleRate:d,errorSampleRate:c,maskAllText:u=!0,maskAllInputs:h=!0,blockAllMedia:p=!0,mutationBreadcrumbLimit:m=750,mutationLimit:f=1e4,slowClickTimeout:g=7e3,slowClickIgnoreSelectors:y=[],networkDetailAllowUrls:S=[],networkDetailDenyUrls:_=[],networkCaptureBodies:v=!0,networkRequestHeaders:b=[],networkResponseHeaders:E=[],mask:w=[],maskAttributes:k=["title","placeholder"],unmask:I=[],block:R=[],unblock:M=[],ignore:T=[],maskFn:C,beforeAddRecordingEvent:x,beforeErrorSampling:N,blockClass:D,blockSelector:A,maskInputOptions:B,maskTextClass:L,maskTextSelector:P,ignoreClass:F}={}){this.name=Replay.id;let W=getPrivacyOptions({mask:w,unmask:I,block:R,unblock:M,ignore:T,blockClass:D,blockSelector:A,maskTextClass:L,maskTextSelector:P,ignoreClass:F});if(this._recordingOptions={maskAllInputs:h,maskAllText:u,maskInputOptions:{...B||{},password:!0},maskTextFn:C,maskInputFn:C,maskAttributeFn:(t,r,n)=>maskAttribute({maskAttributes:k,maskAllText:u,privacyOptions:W,key:t,value:r,el:n}),...W,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:t=>{try{t.__rrweb__=!0}catch(t){}}},this._initialOptions={flushMinDelay:t,flushMaxDelay:r,minReplayDuration:Math.min(n,15e3),maxReplayDuration:Math.min(i,36e5),stickySession:s,sessionSampleRate:d,errorSampleRate:c,useCompression:o,workerUrl:a,blockAllMedia:p,maskAllInputs:h,maskAllText:u,mutationBreadcrumbLimit:m,mutationLimit:f,slowClickTimeout:g,slowClickIgnoreSelectors:y,networkDetailAllowUrls:S,networkDetailDenyUrls:_,networkCaptureBodies:v,networkRequestHeaders:_getMergedNetworkHeaders(b),networkResponseHeaders:_getMergedNetworkHeaders(E),beforeAddRecordingEvent:x,beforeErrorSampling:N,_experiments:l},"number"==typeof d&&(console.warn(`[Replay] You are passing \`sessionSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysSessionSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysSessionSampleRate: ${d} })`),this._initialOptions.sessionSampleRate=d),"number"==typeof c&&(console.warn(`[Replay] You are passing \`errorSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysOnErrorSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysOnErrorSampleRate: ${c} })`),this._initialOptions.errorSampleRate=c),this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${ed}`:ed),this._isInitialized&&(0,O.j)())throw Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return eu}set _isInitialized(t){eu=t}setupOnce(){(0,O.j)()&&(this._setup(),setTimeout(()=>this._initialize()))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:"session"===this._replay.recordingMode}):Promise.resolve()}flush(t){return this._replay&&this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(t):Promise.resolve()}getReplayId(){if(this._replay&&this._replay.isEnabled())return this._replay.getSessionId()}_initialize(){this._replay&&this._replay.initializeSampling()}_setup(){let t=loadReplayOptionsFromClient(this._initialOptions);this._replay=new ReplayContainer({options:t,recordingOptions:this._recordingOptions})}};function loadReplayOptionsFromClient(t){let r=(0,y.Gd)().getClient(),n=r&&r.getOptions(),i={sessionSampleRate:0,errorSampleRate:0,...(0,k.Jr)(t)};return n?(null==t.sessionSampleRate&&null==t.errorSampleRate&&null==n.replaysSessionSampleRate&&null==n.replaysOnErrorSampleRate&&console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set."),"number"==typeof n.replaysSessionSampleRate&&(i.sessionSampleRate=n.replaysSessionSampleRate),"number"==typeof n.replaysOnErrorSampleRate&&(i.errorSampleRate=n.replaysOnErrorSampleRate)):console.warn("SDK client is not available."),i}function _getMergedNetworkHeaders(t){return[...ec,...t.map(t=>t.toLowerCase())]}Replay.__initStatic()}}]);